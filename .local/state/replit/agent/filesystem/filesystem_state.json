{"file_contents":{"client/stores/userStore.ts":{"content":"import { create } from 'zustand';\nimport { persist, createJSONStorage } from 'zustand/middleware';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport type { User, EmergencyContact, Journey } from '@shared/schema';\nimport { apiRequest, getApiUrl } from '@/lib/query-client';\n\ninterface UserState {\n  userId: string | null;\n  user: User | null;\n  emergencyContacts: EmergencyContact[];\n  activeJourney: Journey | null;\n  isOnboarded: boolean;\n  hasLocationPermission: boolean;\n  \n  setUserId: (id: string | null) => void;\n  setUser: (user: User | null) => void;\n  setEmergencyContacts: (contacts: EmergencyContact[]) => void;\n  addEmergencyContact: (contact: EmergencyContact) => void;\n  removeEmergencyContact: (id: string) => void;\n  setActiveJourney: (journey: Journey | null) => void;\n  setOnboarded: (value: boolean) => void;\n  setLocationPermission: (value: boolean) => void;\n  \n  sendOTP: (phone: string) => Promise<{ success: boolean; error?: string }>;\n  verifyOTP: (phone: string, code: string) => Promise<{ valid: boolean; error?: string }>;\n  createUserWithPhone: (phone: string, avatarIndex?: number) => Promise<User>;\n  createUser: (name: string, avatarIndex?: number) => Promise<User>;\n  fetchUser: (id: string) => Promise<User | null>;\n  updateUser: (data: Partial<User>) => Promise<User | null>;\n  fetchEmergencyContacts: () => Promise<void>;\n  createEmergencyContact: (contact: Omit<EmergencyContact, 'id' | 'createdAt'>) => Promise<EmergencyContact | null>;\n  deleteEmergencyContact: (id: string) => Promise<boolean>;\n  fetchActiveJourney: () => Promise<Journey | null>;\n  createJourney: (data: {\n    startLocation: string;\n    startLatitude?: string;\n    startLongitude?: string;\n    destination: string;\n    estimatedDuration: number;\n    bufferTime?: number;\n    note?: string;\n  }) => Promise<Journey | null>;\n  completeJourney: (arrived: boolean) => Promise<void>;\n  sendSOSAlert: (latitude?: string, longitude?: string) => Promise<boolean>;\n  reset: () => void;\n}\n\nexport const useUserStore = create<UserState>()(\n  persist(\n    (set, get) => ({\n      userId: null,\n      user: null,\n      emergencyContacts: [],\n      activeJourney: null,\n      isOnboarded: false,\n      hasLocationPermission: false,\n\n      setUserId: (id) => set({ userId: id }),\n      setUser: (user) => set({ user }),\n      setEmergencyContacts: (contacts) => set({ emergencyContacts: contacts }),\n      addEmergencyContact: (contact) =>\n        set((state) => ({ emergencyContacts: [...state.emergencyContacts, contact] })),\n      removeEmergencyContact: (id) =>\n        set((state) => ({\n          emergencyContacts: state.emergencyContacts.filter((c) => c.id !== id),\n        })),\n      setActiveJourney: (journey) => set({ activeJourney: journey }),\n      setOnboarded: (value) => set({ isOnboarded: value }),\n      setLocationPermission: (value) => set({ hasLocationPermission: value }),\n\n      sendOTP: async (phone) => {\n        try {\n          const res = await apiRequest('POST', '/api/otp/send', { phone });\n          const data = await res.json();\n          return { success: data.success, error: data.error };\n        } catch (error: any) {\n          console.error('Failed to send OTP:', error);\n          return { success: false, error: error.message || 'Failed to send verification code' };\n        }\n      },\n\n      verifyOTP: async (phone, code) => {\n        try {\n          const res = await apiRequest('POST', '/api/otp/verify', { phone, code });\n          const data = await res.json();\n          return { valid: data.valid, error: data.error };\n        } catch (error: any) {\n          console.error('Failed to verify OTP:', error);\n          return { valid: false, error: error.message || 'Failed to verify code' };\n        }\n      },\n\n      createUserWithPhone: async (phone, avatarIndex = 0) => {\n        try {\n          const res = await apiRequest('POST', '/api/users', { phone, phoneVerified: true, avatarIndex });\n          const user = await res.json();\n          set({ user, userId: user.id, isOnboarded: true });\n          return user;\n        } catch (error) {\n          console.error('Failed to create user:', error);\n          throw error;\n        }\n      },\n\n      createUser: async (name, avatarIndex = 0) => {\n        try {\n          const res = await apiRequest('POST', '/api/users', { name, avatarIndex });\n          const user = await res.json();\n          set({ user, userId: user.id, isOnboarded: true });\n          return user;\n        } catch (error) {\n          console.error('Failed to create user:', error);\n          throw error;\n        }\n      },\n\n      fetchUser: async (id) => {\n        try {\n          const baseUrl = getApiUrl();\n          const url = new URL(`/api/users/${id}`, baseUrl);\n          const res = await fetch(url.toString());\n          if (!res.ok) return null;\n          const user = await res.json();\n          set({ user });\n          return user;\n        } catch (error) {\n          console.error('Failed to fetch user:', error);\n          return null;\n        }\n      },\n\n      updateUser: async (data) => {\n        const { userId } = get();\n        if (!userId) return null;\n        try {\n          const res = await apiRequest('PATCH', `/api/users/${userId}`, data);\n          const user = await res.json();\n          set({ user });\n          return user;\n        } catch (error) {\n          console.error('Failed to update user:', error);\n          return null;\n        }\n      },\n\n      fetchEmergencyContacts: async () => {\n        const { userId } = get();\n        if (!userId) return;\n        try {\n          const baseUrl = getApiUrl();\n          const url = new URL(`/api/users/${userId}/contacts`, baseUrl);\n          const res = await fetch(url.toString());\n          if (!res.ok) return;\n          const contacts = await res.json();\n          set({ emergencyContacts: contacts });\n        } catch (error) {\n          console.error('Failed to fetch contacts:', error);\n        }\n      },\n\n      createEmergencyContact: async (contact) => {\n        const { userId } = get();\n        if (!userId) return null;\n        try {\n          const res = await apiRequest('POST', '/api/contacts', { ...contact, userId });\n          const newContact = await res.json();\n          set((state) => ({ emergencyContacts: [...state.emergencyContacts, newContact] }));\n          return newContact;\n        } catch (error) {\n          console.error('Failed to create contact:', error);\n          return null;\n        }\n      },\n\n      deleteEmergencyContact: async (id) => {\n        try {\n          await apiRequest('DELETE', `/api/contacts/${id}`);\n          set((state) => ({\n            emergencyContacts: state.emergencyContacts.filter((c) => c.id !== id),\n          }));\n          return true;\n        } catch (error) {\n          console.error('Failed to delete contact:', error);\n          return false;\n        }\n      },\n\n      fetchActiveJourney: async () => {\n        const { userId } = get();\n        if (!userId) return null;\n        try {\n          const baseUrl = getApiUrl();\n          const url = new URL(`/api/users/${userId}/journeys/active`, baseUrl);\n          const res = await fetch(url.toString());\n          if (!res.ok) return null;\n          const journey = await res.json();\n          set({ activeJourney: journey });\n          return journey;\n        } catch (error) {\n          console.error('Failed to fetch active journey:', error);\n          return null;\n        }\n      },\n\n      createJourney: async (data) => {\n        const { userId } = get();\n        if (!userId) return null;\n        try {\n          const expectedArrival = new Date(\n            Date.now() + (data.estimatedDuration + (data.bufferTime || 10)) * 60 * 1000\n          );\n          const res = await apiRequest('POST', '/api/journeys', {\n            ...data,\n            userId,\n            status: 'active',\n            expectedArrival: expectedArrival.toISOString(),\n          });\n          const journey = await res.json();\n          set({ activeJourney: journey });\n          return journey;\n        } catch (error) {\n          console.error('Failed to create journey:', error);\n          return null;\n        }\n      },\n\n      completeJourney: async (arrived) => {\n        const { activeJourney } = get();\n        if (!activeJourney) return;\n        try {\n          await apiRequest('PATCH', `/api/journeys/${activeJourney.id}`, {\n            status: arrived ? 'completed' : 'cancelled',\n            completedAt: new Date().toISOString(),\n          });\n          set({ activeJourney: null });\n        } catch (error) {\n          console.error('Failed to complete journey:', error);\n        }\n      },\n\n      sendSOSAlert: async (latitude, longitude) => {\n        const { userId, activeJourney } = get();\n        if (!userId) return false;\n        try {\n          await apiRequest('POST', '/api/alerts', {\n            userId,\n            journeyId: activeJourney?.id || null,\n            type: 'sos',\n            latitude,\n            longitude,\n            status: 'sent',\n          });\n          return true;\n        } catch (error) {\n          console.error('Failed to send SOS alert:', error);\n          return false;\n        }\n      },\n\n      reset: () =>\n        set({\n          userId: null,\n          user: null,\n          emergencyContacts: [],\n          activeJourney: null,\n          isOnboarded: false,\n          hasLocationPermission: false,\n        }),\n    }),\n    {\n      name: 'safe-connect-storage',\n      storage: createJSONStorage(() => AsyncStorage),\n      partialize: (state) => ({\n        userId: state.userId,\n        isOnboarded: state.isOnboarded,\n        hasLocationPermission: state.hasLocationPermission,\n      }),\n    }\n  )\n);\n","path":null,"size_bytes":9746,"size_tokens":null},"client/components/ErrorBoundary.tsx":{"content":"import React, { Component, ComponentType, PropsWithChildren } from \"react\";\nimport { ErrorFallback, ErrorFallbackProps } from \"@/components/ErrorFallback\";\n\nexport type ErrorBoundaryProps = PropsWithChildren<{\n  FallbackComponent?: ComponentType<ErrorFallbackProps>;\n  onError?: (error: Error, stackTrace: string) => void;\n}>;\n\ntype ErrorBoundaryState = { error: Error | null };\n\n/**\n * This is a special case for for using the class components. Error boundaries must be class components because React only provides error boundary functionality through lifecycle methods (componentDidCatch and getDerivedStateFromError) which are not available in functional components.\n * https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary\n */\n\nexport class ErrorBoundary extends Component<\n  ErrorBoundaryProps,\n  ErrorBoundaryState\n> {\n  state: ErrorBoundaryState = { error: null };\n\n  static defaultProps: {\n    FallbackComponent: ComponentType<ErrorFallbackProps>;\n  } = {\n    FallbackComponent: ErrorFallback,\n  };\n\n  static getDerivedStateFromError(error: Error): ErrorBoundaryState {\n    return { error };\n  }\n\n  componentDidCatch(error: Error, info: { componentStack: string }): void {\n    if (typeof this.props.onError === \"function\") {\n      this.props.onError(error, info.componentStack);\n    }\n  }\n\n  resetError = (): void => {\n    this.setState({ error: null });\n  };\n\n  render() {\n    const { FallbackComponent } = this.props;\n\n    return this.state.error && FallbackComponent ? (\n      <FallbackComponent\n        error={this.state.error}\n        resetError={this.resetError}\n      />\n    ) : (\n      this.props.children\n    );\n  }\n}\n","path":null,"size_bytes":1674,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\nconst { Pool } = pg;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":395,"size_tokens":null},"client/components/SOSConfirmModal.tsx":{"content":"import React from \"react\";\nimport {\n  View,\n  Modal,\n  StyleSheet,\n  Pressable,\n  ActivityIndicator,\n} from \"react-native\";\nimport { BlurView } from \"expo-blur\";\nimport { Feather } from \"@expo/vector-icons\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Spacing, BorderRadius, Typography } from \"@/constants/theme\";\n\ninterface SOSConfirmModalProps {\n  visible: boolean;\n  onConfirm: () => void;\n  onCancel: () => void;\n  isLoading?: boolean;\n}\n\nexport default function SOSConfirmModal({\n  visible,\n  onConfirm,\n  onCancel,\n  isLoading = false,\n}: SOSConfirmModalProps) {\n  const { theme, isDark } = useTheme();\n\n  return (\n    <Modal\n      visible={visible}\n      transparent\n      animationType=\"fade\"\n      onRequestClose={onCancel}\n    >\n      <View style={styles.overlay}>\n        <BlurView\n          intensity={50}\n          tint={isDark ? \"dark\" : \"light\"}\n          style={StyleSheet.absoluteFill}\n        />\n        <View style={[styles.modal, { backgroundColor: theme.cardBackground }]}>\n          <View style={[styles.iconContainer, { backgroundColor: theme.danger + \"20\" }]}>\n            <Feather name=\"alert-triangle\" size={48} color={theme.danger} />\n          </View>\n\n          <ThemedText style={styles.title}>Send Emergency Alert?</ThemedText>\n          <ThemedText style={[styles.description, { color: theme.textSecondary }]}>\n            This will immediately notify all your emergency contacts with your current location.\n          </ThemedText>\n\n          <View style={styles.buttonContainer}>\n            <Pressable\n              style={[styles.cancelButton, { borderColor: theme.border }]}\n              onPress={onCancel}\n              disabled={isLoading}\n            >\n              <ThemedText style={styles.cancelButtonText}>Cancel</ThemedText>\n            </Pressable>\n\n            <Pressable\n              style={[\n                styles.confirmButton,\n                { backgroundColor: theme.danger },\n                isLoading && { opacity: 0.6 },\n              ]}\n              onPress={onConfirm}\n              disabled={isLoading}\n            >\n              {isLoading ? (\n                <ActivityIndicator color=\"#FFF\" />\n              ) : (\n                <>\n                  <Feather name=\"alert-circle\" size={20} color=\"#FFF\" />\n                  <ThemedText style={styles.confirmButtonText}>Send SOS</ThemedText>\n                </>\n              )}\n            </Pressable>\n          </View>\n        </View>\n      </View>\n    </Modal>\n  );\n}\n\nconst styles = StyleSheet.create({\n  overlay: {\n    flex: 1,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    padding: Spacing.xl,\n  },\n  modal: {\n    width: \"100%\",\n    maxWidth: 340,\n    borderRadius: BorderRadius.lg,\n    padding: Spacing[\"2xl\"],\n    alignItems: \"center\",\n    shadowColor: \"#000\",\n    shadowOffset: { width: 0, height: 8 },\n    shadowOpacity: 0.15,\n    shadowRadius: 24,\n    elevation: 8,\n  },\n  iconContainer: {\n    width: 80,\n    height: 80,\n    borderRadius: 40,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    marginBottom: Spacing.lg,\n  },\n  title: {\n    ...Typography.h3,\n    textAlign: \"center\",\n    marginBottom: Spacing.sm,\n  },\n  description: {\n    ...Typography.body,\n    textAlign: \"center\",\n    marginBottom: Spacing[\"2xl\"],\n  },\n  buttonContainer: {\n    flexDirection: \"row\",\n    gap: Spacing.md,\n    width: \"100%\",\n  },\n  cancelButton: {\n    flex: 1,\n    height: 48,\n    borderRadius: BorderRadius.sm,\n    borderWidth: 2,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  cancelButtonText: {\n    ...Typography.body,\n    fontWeight: \"600\",\n  },\n  confirmButton: {\n    flex: 1,\n    height: 48,\n    borderRadius: BorderRadius.sm,\n    flexDirection: \"row\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    gap: Spacing.sm,\n  },\n  confirmButtonText: {\n    ...Typography.body,\n    fontWeight: \"600\",\n    color: \"#FFF\",\n  },\n});\n","path":null,"size_bytes":3955,"size_tokens":null},"client/index.js":{"content":"import { registerRootComponent } from \"expo\";\n\nimport App from \"@/App\";\n\nregisterRootComponent(App);\n","path":null,"size_bytes":101,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { \n  insertUserSchema, \n  insertEmergencyContactSchema, \n  insertJourneySchema, \n  insertAlertSchema \n} from \"@shared/schema\";\nimport {\n  sendSOSAlertSMS,\n  sendJourneyStartSMS,\n  sendJourneyCompletedSMS,\n  sendJourneyOverdueSMS,\n  sendOTP,\n  verifyOTP\n} from \"./vonage\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // User routes\n  app.get(\"/api/users/:id\", async (req, res) => {\n    try {\n      const user = await storage.getUser(req.params.id);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      res.json(user);\n    } catch (error) {\n      console.error(\"Failed to get user:\", error);\n      res.status(500).json({ error: \"Failed to get user\" });\n    }\n  });\n\n  app.post(\"/api/users\", async (req, res) => {\n    try {\n      const parsed = insertUserSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ error: parsed.error.message });\n      }\n      const user = await storage.createUser(parsed.data);\n      res.status(201).json(user);\n    } catch (error) {\n      console.error(\"Failed to create user:\", error);\n      res.status(500).json({ error: \"Failed to create user\" });\n    }\n  });\n\n  app.patch(\"/api/users/:id\", async (req, res) => {\n    try {\n      const user = await storage.updateUser(req.params.id, req.body);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      res.json(user);\n    } catch (error) {\n      console.error(\"Failed to update user:\", error);\n      res.status(500).json({ error: \"Failed to update user\" });\n    }\n  });\n\n  // OTP verification routes\n  app.post(\"/api/otp/send\", async (req, res) => {\n    try {\n      const { phone } = req.body;\n      if (!phone) {\n        return res.status(400).json({ error: \"Phone number is required\" });\n      }\n      \n      const result = await sendOTP(phone);\n      if (result.success) {\n        res.json({ success: true, message: \"Verification code sent\" });\n      } else {\n        res.status(500).json({ success: false, error: result.error || \"Failed to send verification code\" });\n      }\n    } catch (error) {\n      console.error(\"Failed to send OTP:\", error);\n      res.status(500).json({ error: \"Failed to send verification code\" });\n    }\n  });\n\n  app.post(\"/api/otp/verify\", async (req, res) => {\n    try {\n      const { phone, code } = req.body;\n      if (!phone || !code) {\n        return res.status(400).json({ error: \"Phone and code are required\" });\n      }\n      \n      const result = verifyOTP(phone, code);\n      if (result.valid) {\n        res.json({ valid: true, message: \"Phone verified successfully\" });\n      } else {\n        res.status(400).json({ valid: false, error: result.error });\n      }\n    } catch (error) {\n      console.error(\"Failed to verify OTP:\", error);\n      res.status(500).json({ error: \"Failed to verify code\" });\n    }\n  });\n\n  // Emergency contacts routes\n  app.get(\"/api/users/:userId/contacts\", async (req, res) => {\n    try {\n      const contacts = await storage.getEmergencyContacts(req.params.userId);\n      res.json(contacts);\n    } catch (error) {\n      console.error(\"Failed to get contacts:\", error);\n      res.status(500).json({ error: \"Failed to get contacts\" });\n    }\n  });\n\n  app.post(\"/api/contacts\", async (req, res) => {\n    try {\n      const parsed = insertEmergencyContactSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ error: parsed.error.message });\n      }\n      const contact = await storage.createEmergencyContact(parsed.data);\n      res.status(201).json(contact);\n    } catch (error) {\n      console.error(\"Failed to create contact:\", error);\n      res.status(500).json({ error: \"Failed to create contact\" });\n    }\n  });\n\n  app.patch(\"/api/contacts/:id\", async (req, res) => {\n    try {\n      const contact = await storage.updateEmergencyContact(req.params.id, req.body);\n      if (!contact) {\n        return res.status(404).json({ error: \"Contact not found\" });\n      }\n      res.json(contact);\n    } catch (error) {\n      console.error(\"Failed to update contact:\", error);\n      res.status(500).json({ error: \"Failed to update contact\" });\n    }\n  });\n\n  app.delete(\"/api/contacts/:id\", async (req, res) => {\n    try {\n      const deleted = await storage.deleteEmergencyContact(req.params.id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Contact not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Failed to delete contact:\", error);\n      res.status(500).json({ error: \"Failed to delete contact\" });\n    }\n  });\n\n  // Journey routes\n  app.get(\"/api/users/:userId/journeys\", async (req, res) => {\n    try {\n      const journeysData = await storage.getJourneys(req.params.userId);\n      res.json(journeysData);\n    } catch (error) {\n      console.error(\"Failed to get journeys:\", error);\n      res.status(500).json({ error: \"Failed to get journeys\" });\n    }\n  });\n\n  app.get(\"/api/users/:userId/journeys/active\", async (req, res) => {\n    try {\n      const journey = await storage.getActiveJourney(req.params.userId);\n      res.json(journey || null);\n    } catch (error) {\n      console.error(\"Failed to get active journey:\", error);\n      res.status(500).json({ error: \"Failed to get active journey\" });\n    }\n  });\n\n  app.get(\"/api/journeys/:id\", async (req, res) => {\n    try {\n      const journey = await storage.getJourney(req.params.id);\n      if (!journey) {\n        return res.status(404).json({ error: \"Journey not found\" });\n      }\n      res.json(journey);\n    } catch (error) {\n      console.error(\"Failed to get journey:\", error);\n      res.status(500).json({ error: \"Failed to get journey\" });\n    }\n  });\n\n  app.post(\"/api/journeys\", async (req, res) => {\n    try {\n      const parsed = insertJourneySchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ error: parsed.error.message });\n      }\n      const journey = await storage.createJourney(parsed.data);\n      \n      // Send SMS notifications to emergency contacts\n      const user = await storage.getUser(parsed.data.userId);\n      const contacts = await storage.getEmergencyContacts(parsed.data.userId);\n      \n      if (user && contacts.length > 0) {\n        const expectedArrival = new Date(String(parsed.data.expectedArrival));\n        \n        for (const contact of contacts) {\n          try {\n            await sendJourneyStartSMS(\n              contact.phone,\n              contact.name,\n              user.name,\n              parsed.data.startLocation,\n              parsed.data.destination,\n              parsed.data.estimatedDuration,\n              expectedArrival\n            );\n          } catch (smsError) {\n            console.error(`Failed to send journey start SMS to ${contact.name}:`, smsError);\n          }\n        }\n      }\n      \n      res.status(201).json(journey);\n    } catch (error) {\n      console.error(\"Failed to create journey:\", error);\n      res.status(500).json({ error: \"Failed to create journey\" });\n    }\n  });\n\n  app.patch(\"/api/journeys/:id\", async (req, res) => {\n    try {\n      const journey = await storage.updateJourney(req.params.id, req.body);\n      if (!journey) {\n        return res.status(404).json({ error: \"Journey not found\" });\n      }\n      \n      // If journey is completed, notify contacts\n      if (req.body.status === \"completed\") {\n        const user = await storage.getUser(journey.userId);\n        const contacts = await storage.getEmergencyContacts(journey.userId);\n        \n        if (user && contacts.length > 0) {\n          for (const contact of contacts) {\n            try {\n              await sendJourneyCompletedSMS(\n                contact.phone,\n                contact.name,\n                user.name,\n                journey.destination\n              );\n            } catch (smsError) {\n              console.error(`Failed to send journey completed SMS to ${contact.name}:`, smsError);\n            }\n          }\n        }\n      }\n      \n      res.json(journey);\n    } catch (error) {\n      console.error(\"Failed to update journey:\", error);\n      res.status(500).json({ error: \"Failed to update journey\" });\n    }\n  });\n\n  // Alert routes\n  app.get(\"/api/users/:userId/alerts\", async (req, res) => {\n    try {\n      const alertsData = await storage.getAlerts(req.params.userId);\n      res.json(alertsData);\n    } catch (error) {\n      console.error(\"Failed to get alerts:\", error);\n      res.status(500).json({ error: \"Failed to get alerts\" });\n    }\n  });\n\n  app.post(\"/api/alerts\", async (req, res) => {\n    try {\n      const parsed = insertAlertSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ error: parsed.error.message });\n      }\n      const alert = await storage.createAlert(parsed.data);\n      \n      // Send SOS SMS to all emergency contacts\n      if (parsed.data.type === \"sos\") {\n        const user = await storage.getUser(parsed.data.userId);\n        const contacts = await storage.getEmergencyContacts(parsed.data.userId);\n        \n        if (user && contacts.length > 0) {\n          for (const contact of contacts) {\n            try {\n              await sendSOSAlertSMS(\n                contact.phone,\n                contact.name,\n                user.name,\n                parsed.data.latitude ?? undefined,\n                parsed.data.longitude ?? undefined\n              );\n            } catch (smsError) {\n              console.error(`Failed to send SOS SMS to ${contact.name}:`, smsError);\n            }\n          }\n        }\n      }\n      \n      // Send journey overdue alert\n      if (parsed.data.type === \"overdue\" && parsed.data.journeyId) {\n        const user = await storage.getUser(parsed.data.userId);\n        const contacts = await storage.getEmergencyContacts(parsed.data.userId);\n        const journey = await storage.getJourney(parsed.data.journeyId);\n        \n        if (user && contacts.length > 0 && journey) {\n          for (const contact of contacts) {\n            try {\n              await sendJourneyOverdueSMS(\n                contact.phone,\n                contact.name,\n                user.name,\n                journey.destination,\n                journey.startLocation,\n                parsed.data.latitude ?? undefined,\n                parsed.data.longitude ?? undefined\n              );\n            } catch (smsError) {\n              console.error(`Failed to send overdue SMS to ${contact.name}:`, smsError);\n            }\n          }\n        }\n      }\n      \n      res.status(201).json(alert);\n    } catch (error) {\n      console.error(\"Failed to create alert:\", error);\n      res.status(500).json({ error: \"Failed to create alert\" });\n    }\n  });\n\n  app.patch(\"/api/alerts/:id\", async (req, res) => {\n    try {\n      const alert = await storage.updateAlert(req.params.id, req.body);\n      if (!alert) {\n        return res.status(404).json({ error: \"Alert not found\" });\n      }\n      res.json(alert);\n    } catch (error) {\n      console.error(\"Failed to update alert:\", error);\n      res.status(500).json({ error: \"Failed to update alert\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","path":null,"size_bytes":11345,"size_tokens":null},"client/hooks/useColorScheme.web.ts":{"content":"import { useEffect, useState } from \"react\";\nimport { useColorScheme as useRNColorScheme } from \"react-native\";\n\n/**\n * To support static rendering, this value needs to be re-calculated on the client side for web\n */\nexport function useColorScheme() {\n  const [hasHydrated, setHasHydrated] = useState(false);\n\n  useEffect(() => {\n    setHasHydrated(true);\n  }, []);\n\n  const colorScheme = useRNColorScheme();\n\n  if (hasHydrated) {\n    return colorScheme;\n  }\n\n  return \"light\";\n}\n","path":null,"size_bytes":480,"size_tokens":null},"server/storage.ts":{"content":"import { \n  users, emergencyContacts, journeys, alerts,\n  type User, type InsertUser,\n  type EmergencyContact, type InsertEmergencyContact,\n  type Journey, type InsertJourney,\n  type Alert, type InsertAlert\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc } from \"drizzle-orm\";\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUser(id: string, data: Partial<InsertUser>): Promise<User | undefined>;\n  \n  getEmergencyContacts(userId: string): Promise<EmergencyContact[]>;\n  getEmergencyContact(id: string): Promise<EmergencyContact | undefined>;\n  createEmergencyContact(contact: InsertEmergencyContact): Promise<EmergencyContact>;\n  updateEmergencyContact(id: string, data: Partial<InsertEmergencyContact>): Promise<EmergencyContact | undefined>;\n  deleteEmergencyContact(id: string): Promise<boolean>;\n  \n  getJourneys(userId: string): Promise<Journey[]>;\n  getJourney(id: string): Promise<Journey | undefined>;\n  getActiveJourney(userId: string): Promise<Journey | undefined>;\n  createJourney(journey: InsertJourney): Promise<Journey>;\n  updateJourney(id: string, data: Partial<Journey>): Promise<Journey | undefined>;\n  \n  getAlerts(userId: string): Promise<Alert[]>;\n  createAlert(alert: InsertAlert): Promise<Alert>;\n  updateAlert(id: string, data: Partial<Alert>): Promise<Alert | undefined>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(insertUser)\n      .returning();\n    return user;\n  }\n\n  async updateUser(id: string, data: Partial<InsertUser>): Promise<User | undefined> {\n    const [user] = await db\n      .update(users)\n      .set(data)\n      .where(eq(users.id, id))\n      .returning();\n    return user || undefined;\n  }\n\n  async getEmergencyContacts(userId: string): Promise<EmergencyContact[]> {\n    return db.select().from(emergencyContacts).where(eq(emergencyContacts.userId, userId));\n  }\n\n  async getEmergencyContact(id: string): Promise<EmergencyContact | undefined> {\n    const [contact] = await db.select().from(emergencyContacts).where(eq(emergencyContacts.id, id));\n    return contact || undefined;\n  }\n\n  async createEmergencyContact(contact: InsertEmergencyContact): Promise<EmergencyContact> {\n    const [newContact] = await db\n      .insert(emergencyContacts)\n      .values(contact)\n      .returning();\n    return newContact;\n  }\n\n  async updateEmergencyContact(id: string, data: Partial<InsertEmergencyContact>): Promise<EmergencyContact | undefined> {\n    const [contact] = await db\n      .update(emergencyContacts)\n      .set(data)\n      .where(eq(emergencyContacts.id, id))\n      .returning();\n    return contact || undefined;\n  }\n\n  async deleteEmergencyContact(id: string): Promise<boolean> {\n    const result = await db\n      .delete(emergencyContacts)\n      .where(eq(emergencyContacts.id, id))\n      .returning();\n    return result.length > 0;\n  }\n\n  async getJourneys(userId: string): Promise<Journey[]> {\n    return db\n      .select()\n      .from(journeys)\n      .where(eq(journeys.userId, userId))\n      .orderBy(desc(journeys.createdAt));\n  }\n\n  async getJourney(id: string): Promise<Journey | undefined> {\n    const [journey] = await db.select().from(journeys).where(eq(journeys.id, id));\n    return journey || undefined;\n  }\n\n  async getActiveJourney(userId: string): Promise<Journey | undefined> {\n    const [journey] = await db\n      .select()\n      .from(journeys)\n      .where(eq(journeys.userId, userId))\n      .orderBy(desc(journeys.createdAt))\n      .limit(1);\n    \n    if (journey && journey.status === \"active\") {\n      return journey;\n    }\n    return undefined;\n  }\n\n  async createJourney(journey: InsertJourney): Promise<Journey> {\n    const [newJourney] = await db\n      .insert(journeys)\n      .values(journey)\n      .returning();\n    return newJourney;\n  }\n\n  async updateJourney(id: string, data: Partial<Journey>): Promise<Journey | undefined> {\n    const [journey] = await db\n      .update(journeys)\n      .set(data)\n      .where(eq(journeys.id, id))\n      .returning();\n    return journey || undefined;\n  }\n\n  async getAlerts(userId: string): Promise<Alert[]> {\n    return db\n      .select()\n      .from(alerts)\n      .where(eq(alerts.userId, userId))\n      .orderBy(desc(alerts.createdAt));\n  }\n\n  async createAlert(alert: InsertAlert): Promise<Alert> {\n    const [newAlert] = await db\n      .insert(alerts)\n      .values(alert)\n      .returning();\n    return newAlert;\n  }\n\n  async updateAlert(id: string, data: Partial<Alert>): Promise<Alert | undefined> {\n    const [alert] = await db\n      .update(alerts)\n      .set(data)\n      .where(eq(alerts.id, id))\n      .returning();\n    return alert || undefined;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":5032,"size_tokens":null},"client/lib/query-client.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\n/**\n * Gets the base URL for the Express API server (e.g., \"http://localhost:3000\")\n * @returns {string} The API base URL\n */\nexport function getApiUrl(): string {\n  let host = process.env.EXPO_PUBLIC_DOMAIN;\n\n  if (!host) {\n    throw new Error(\"EXPO_PUBLIC_DOMAIN is not set\");\n  }\n\n  let url = new URL(`https://${host}`);\n\n  return url.href;\n}\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  route: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const baseUrl = getApiUrl();\n  const url = new URL(route, baseUrl);\n\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const baseUrl = getApiUrl();\n    const url = new URL(queryKey.join(\"/\") as string, baseUrl);\n\n    const res = await fetch(url, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1876,"size_tokens":null},"client/components/Spacer.tsx":{"content":"import { View } from \"react-native\";\n\ntype Props = {\n  width?: number;\n  height?: number;\n};\n\nexport default function Spacer(props: Props) {\n  const width: number = props.width ?? 1;\n  const height: number = props.height ?? 1;\n\n  return (\n    <View\n      style={{\n        width,\n        height,\n      }}\n    />\n  );\n}\n","path":null,"size_bytes":318,"size_tokens":null},"babel.config.js":{"content":"module.exports = function (api) {\n  api.cache(true);\n  return {\n    presets: [\"babel-preset-expo\"],\n    plugins: [\n      [\n        \"module-resolver\",\n        {\n          root: [\"./\"],\n          alias: {\n            \"@\": \"./client\",\n            \"@shared\": \"./shared\",\n          },\n          extensions: [\".ios.js\", \".android.js\", \".js\", \".ts\", \".tsx\", \".json\"],\n        },\n      ],\n      \"react-native-reanimated/plugin\",\n    ],\n  };\n};\n","path":null,"size_bytes":436,"size_tokens":null},"client/components/Card.tsx":{"content":"import React from \"react\";\nimport { StyleSheet, Pressable, ViewStyle } from \"react-native\";\nimport Animated, {\n  useAnimatedStyle,\n  useSharedValue,\n  withSpring,\n  WithSpringConfig,\n} from \"react-native-reanimated\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Spacing, BorderRadius } from \"@/constants/theme\";\n\ninterface CardProps {\n  elevation?: number;\n  title?: string;\n  description?: string;\n  children?: React.ReactNode;\n  onPress?: () => void;\n  style?: ViewStyle;\n}\n\nconst springConfig: WithSpringConfig = {\n  damping: 15,\n  mass: 0.3,\n  stiffness: 150,\n  overshootClamping: true,\n  energyThreshold: 0.001,\n};\n\nconst getBackgroundColorForElevation = (\n  elevation: number,\n  theme: any,\n): string => {\n  switch (elevation) {\n    case 1:\n      return theme.backgroundDefault;\n    case 2:\n      return theme.backgroundSecondary;\n    case 3:\n      return theme.backgroundTertiary;\n    default:\n      return theme.backgroundRoot;\n  }\n};\n\nconst AnimatedPressable = Animated.createAnimatedComponent(Pressable);\n\nexport function Card({\n  elevation = 1,\n  title,\n  description,\n  children,\n  onPress,\n  style,\n}: CardProps) {\n  const { theme } = useTheme();\n  const scale = useSharedValue(1);\n\n  const cardBackgroundColor = getBackgroundColorForElevation(elevation, theme);\n\n  const animatedStyle = useAnimatedStyle(() => ({\n    transform: [{ scale: scale.value }],\n  }));\n\n  const handlePressIn = () => {\n    scale.value = withSpring(0.98, springConfig);\n  };\n\n  const handlePressOut = () => {\n    scale.value = withSpring(1, springConfig);\n  };\n\n  return (\n    <AnimatedPressable\n      onPress={onPress}\n      onPressIn={handlePressIn}\n      onPressOut={handlePressOut}\n      style={[\n        styles.card,\n        {\n          backgroundColor: cardBackgroundColor,\n        },\n        animatedStyle,\n        style,\n      ]}\n    >\n      {title ? (\n        <ThemedText type=\"h4\" style={styles.cardTitle}>\n          {title}\n        </ThemedText>\n      ) : null}\n      {description ? (\n        <ThemedText type=\"small\" style={styles.cardDescription}>\n          {description}\n        </ThemedText>\n      ) : null}\n      {children}\n    </AnimatedPressable>\n  );\n}\n\nconst styles = StyleSheet.create({\n  card: {\n    padding: Spacing.xl,\n    borderRadius: BorderRadius[\"2xl\"],\n  },\n  cardTitle: {\n    marginBottom: Spacing.sm,\n  },\n  cardDescription: {\n    opacity: 0.7,\n  },\n});\n","path":null,"size_bytes":2437,"size_tokens":null},"client/navigation/RootStackNavigator.tsx":{"content":"import React, { useEffect, useState } from \"react\";\nimport { createNativeStackNavigator } from \"@react-navigation/native-stack\";\nimport MainTabNavigator from \"@/navigation/MainTabNavigator\";\nimport OnboardingScreen from \"@/screens/OnboardingScreen\";\nimport JourneySetupScreen from \"@/screens/JourneySetupScreen\";\nimport ActiveJourneyScreen from \"@/screens/ActiveJourneyScreen\";\nimport EditProfileScreen from \"@/screens/EditProfileScreen\";\nimport EmergencyContactsScreen from \"@/screens/EmergencyContactsScreen\";\nimport AddContactScreen from \"@/screens/AddContactScreen\";\nimport { useScreenOptions } from \"@/hooks/useScreenOptions\";\nimport { useUserStore } from \"@/stores/userStore\";\nimport { View, ActivityIndicator, StyleSheet } from \"react-native\";\nimport { useTheme } from \"@/hooks/useTheme\";\n\nexport type RootStackParamList = {\n  Onboarding: undefined;\n  Main: undefined;\n  JourneySetup: undefined;\n  ActiveJourney: undefined;\n  EditProfile: undefined;\n  EmergencyContacts: undefined;\n  AddContact: { editId?: string } | undefined;\n};\n\nconst Stack = createNativeStackNavigator<RootStackParamList>();\n\nexport default function RootStackNavigator() {\n  const screenOptions = useScreenOptions();\n  const { isOnboarded, userId, fetchUser, fetchEmergencyContacts, fetchActiveJourney } = useUserStore();\n  const { theme } = useTheme();\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    const loadUserData = async () => {\n      if (userId) {\n        await Promise.all([\n          fetchUser(userId),\n          fetchEmergencyContacts(),\n          fetchActiveJourney(),\n        ]);\n      }\n      setIsLoading(false);\n    };\n    loadUserData();\n  }, [userId]);\n\n  if (isLoading) {\n    return (\n      <View style={[styles.loading, { backgroundColor: theme.backgroundRoot }]}>\n        <ActivityIndicator size=\"large\" color={theme.primary} />\n      </View>\n    );\n  }\n\n  return (\n    <Stack.Navigator screenOptions={screenOptions}>\n      {!isOnboarded ? (\n        <Stack.Screen\n          name=\"Onboarding\"\n          component={OnboardingScreen}\n          options={{ headerShown: false }}\n        />\n      ) : (\n        <>\n          <Stack.Screen\n            name=\"Main\"\n            component={MainTabNavigator}\n            options={{ headerShown: false }}\n          />\n          <Stack.Screen\n            name=\"JourneySetup\"\n            component={JourneySetupScreen}\n            options={{ headerTitle: \"Start Journey\" }}\n          />\n          <Stack.Screen\n            name=\"ActiveJourney\"\n            component={ActiveJourneyScreen}\n            options={{ \n              headerTitle: \"Active Journey\",\n              headerBackVisible: false,\n              gestureEnabled: false,\n            }}\n          />\n          <Stack.Screen\n            name=\"EditProfile\"\n            component={EditProfileScreen}\n            options={{ headerTitle: \"Edit Profile\" }}\n          />\n          <Stack.Screen\n            name=\"EmergencyContacts\"\n            component={EmergencyContactsScreen}\n            options={{ headerTitle: \"Emergency Contacts\" }}\n          />\n          <Stack.Screen\n            name=\"AddContact\"\n            component={AddContactScreen}\n            options={{ headerTitle: \"Add Contact\" }}\n          />\n        </>\n      )}\n    </Stack.Navigator>\n  );\n}\n\nconst styles = StyleSheet.create({\n  loading: {\n    flex: 1,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n});\n","path":null,"size_bytes":3412,"size_tokens":null},"client/screens/ActiveJourneyScreen.tsx":{"content":"import React, { useState, useEffect, useCallback, useRef } from \"react\";\nimport {\n  View,\n  StyleSheet,\n  Pressable,\n  Alert,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useNavigation, useFocusEffect } from \"@react-navigation/native\";\nimport type { NativeStackNavigationProp } from \"@react-navigation/native-stack\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as Haptics from \"expo-haptics\";\nimport * as Location from \"expo-location\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { Card } from \"@/components/Card\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useUserStore } from \"@/stores/userStore\";\nimport { Spacing, BorderRadius, Typography } from \"@/constants/theme\";\nimport type { RootStackParamList } from \"@/navigation/RootStackNavigator\";\nimport SOSConfirmModal from \"@/components/SOSConfirmModal\";\n\nexport default function ActiveJourneyScreen() {\n  const insets = useSafeAreaInsets();\n  const navigation = useNavigation<NativeStackNavigationProp<RootStackParamList>>();\n  const { theme } = useTheme();\n  const { activeJourney, completeJourney, sendSOSAlert, hasLocationPermission, fetchActiveJourney } = useUserStore();\n\n  const [timeRemaining, setTimeRemaining] = useState<number>(0);\n  const [showSOSModal, setShowSOSModal] = useState(false);\n  const [isSendingSOS, setIsSendingSOS] = useState(false);\n  const [isCompleting, setIsCompleting] = useState(false);\n  const intervalRef = useRef<NodeJS.Timeout | null>(null);\n\n  useFocusEffect(\n    useCallback(() => {\n      fetchActiveJourney();\n    }, [])\n  );\n\n  useEffect(() => {\n    if (!activeJourney) {\n      navigation.replace(\"Main\");\n      return;\n    }\n\n    const updateTimer = () => {\n      const now = new Date().getTime();\n      const arrival = new Date(activeJourney.expectedArrival).getTime();\n      const diff = Math.max(0, arrival - now);\n      setTimeRemaining(Math.floor(diff / 1000));\n    };\n\n    updateTimer();\n    intervalRef.current = setInterval(updateTimer, 1000);\n\n    return () => {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n      }\n    };\n  }, [activeJourney]);\n\n  const formatTime = (seconds: number) => {\n    if (seconds <= 0) return \"Overdue\";\n    const hours = Math.floor(seconds / 3600);\n    const mins = Math.floor((seconds % 3600) / 60);\n    const secs = seconds % 60;\n\n    if (hours > 0) {\n      return `${hours}:${mins.toString().padStart(2, \"0\")}:${secs.toString().padStart(2, \"0\")}`;\n    }\n    return `${mins}:${secs.toString().padStart(2, \"0\")}`;\n  };\n\n  const handleArrived = async () => {\n    Alert.alert(\n      \"Mark as Arrived?\",\n      \"Confirm that you have arrived safely at your destination.\",\n      [\n        { text: \"Cancel\", style: \"cancel\" },\n        {\n          text: \"I've Arrived\",\n          onPress: async () => {\n            await Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n            setIsCompleting(true);\n            await completeJourney(true);\n            setIsCompleting(false);\n            navigation.replace(\"Main\");\n          },\n        },\n      ]\n    );\n  };\n\n  const handleCancel = () => {\n    Alert.alert(\n      \"Cancel Journey?\",\n      \"Are you sure you want to cancel this journey?\",\n      [\n        { text: \"No, Continue\", style: \"cancel\" },\n        {\n          text: \"Yes, Cancel\",\n          style: \"destructive\",\n          onPress: async () => {\n            await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n            setIsCompleting(true);\n            await completeJourney(false);\n            setIsCompleting(false);\n            navigation.replace(\"Main\");\n          },\n        },\n      ]\n    );\n  };\n\n  const handleSOSPress = async () => {\n    await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Heavy);\n    setShowSOSModal(true);\n  };\n\n  const handleConfirmSOS = async () => {\n    setIsSendingSOS(true);\n    try {\n      let latitude: string | undefined;\n      let longitude: string | undefined;\n\n      if (hasLocationPermission) {\n        try {\n          const location = await Location.getCurrentPositionAsync({\n            accuracy: Location.Accuracy.High,\n          });\n          latitude = location.coords.latitude.toString();\n          longitude = location.coords.longitude.toString();\n        } catch (e) {\n          console.error(\"Failed to get location:\", e);\n        }\n      }\n\n      const success = await sendSOSAlert(latitude, longitude);\n      if (success) {\n        Alert.alert(\n          \"SOS Sent\",\n          \"Emergency alert has been sent to your contacts. Stay safe!\",\n          [{ text: \"OK\" }]\n        );\n      } else {\n        Alert.alert(\"Error\", \"Failed to send SOS alert. Please try again.\");\n      }\n    } catch (error) {\n      Alert.alert(\"Error\", \"Something went wrong. Please call emergency services directly.\");\n    } finally {\n      setIsSendingSOS(false);\n      setShowSOSModal(false);\n    }\n  };\n\n  const isOverdue = timeRemaining <= 0;\n  const progress = activeJourney\n    ? Math.max(0, Math.min(1, 1 - timeRemaining / ((activeJourney.estimatedDuration + (activeJourney.bufferTime || 10)) * 60)))\n    : 0;\n\n  if (!activeJourney) {\n    return null;\n  }\n\n  return (\n    <ThemedView style={styles.container}>\n      <View style={[styles.content, { paddingTop: insets.top + Spacing[\"4xl\"], paddingBottom: insets.bottom + Spacing[\"2xl\"] }]}>\n        <View style={styles.timerSection}>\n          <View\n            style={[\n              styles.timerCircle,\n              {\n                borderColor: isOverdue ? theme.danger : theme.primary,\n                backgroundColor: (isOverdue ? theme.danger : theme.primary) + \"10\",\n              },\n            ]}\n          >\n            <ThemedText\n              style={[\n                styles.timerText,\n                { color: isOverdue ? theme.danger : theme.text },\n              ]}\n            >\n              {formatTime(timeRemaining)}\n            </ThemedText>\n            <ThemedText style={[styles.timerLabel, { color: theme.textSecondary }]}>\n              {isOverdue ? \"Time's up!\" : \"Time remaining\"}\n            </ThemedText>\n          </View>\n\n          {isOverdue && (\n            <View style={[styles.overdueWarning, { backgroundColor: theme.dangerLight }]}>\n              <Feather name=\"alert-triangle\" size={20} color={theme.danger} />\n              <ThemedText style={[styles.overdueText, { color: theme.danger }]}>\n                Your contacts will be notified soon\n              </ThemedText>\n            </View>\n          )}\n        </View>\n\n        <Card style={styles.journeyCard}>\n          <View style={styles.journeyRow}>\n            <View style={[styles.journeyDot, { backgroundColor: theme.success }]} />\n            <View style={styles.journeyInfo}>\n              <ThemedText style={[styles.journeyLabel, { color: theme.textSecondary }]}>\n                From\n              </ThemedText>\n              <ThemedText style={styles.journeyValue}>\n                {activeJourney.startLocation}\n              </ThemedText>\n            </View>\n          </View>\n\n          <View style={[styles.journeyDivider, { backgroundColor: theme.border }]} />\n\n          <View style={styles.journeyRow}>\n            <View style={[styles.journeyDot, { backgroundColor: theme.primary }]} />\n            <View style={styles.journeyInfo}>\n              <ThemedText style={[styles.journeyLabel, { color: theme.textSecondary }]}>\n                To\n              </ThemedText>\n              <ThemedText style={styles.journeyValue}>\n                {activeJourney.destination}\n              </ThemedText>\n            </View>\n          </View>\n\n          {activeJourney.note ? (\n            <View style={[styles.noteSection, { backgroundColor: theme.backgroundSecondary }]}>\n              <Feather name=\"file-text\" size={16} color={theme.textSecondary} />\n              <ThemedText style={[styles.noteText, { color: theme.textSecondary }]}>\n                {activeJourney.note}\n              </ThemedText>\n            </View>\n          ) : null}\n        </Card>\n\n        <View style={styles.buttonSection}>\n          <Pressable\n            style={[\n              styles.arrivedButton,\n              { backgroundColor: theme.success },\n              isCompleting && { opacity: 0.6 },\n            ]}\n            onPress={handleArrived}\n            disabled={isCompleting}\n          >\n            <Feather name=\"check-circle\" size={24} color=\"#FFF\" />\n            <ThemedText style={styles.arrivedButtonText}>I've Arrived Safely</ThemedText>\n          </Pressable>\n\n          <View style={styles.secondaryButtons}>\n            <Pressable\n              style={[styles.cancelButton, { borderColor: theme.border }]}\n              onPress={handleCancel}\n              disabled={isCompleting}\n            >\n              <Feather name=\"x\" size={20} color={theme.text} />\n              <ThemedText style={styles.cancelButtonText}>Cancel</ThemedText>\n            </Pressable>\n\n            <Pressable\n              style={[styles.sosButton, { backgroundColor: theme.danger }]}\n              onPress={handleSOSPress}\n            >\n              <Feather name=\"alert-circle\" size={20} color=\"#FFF\" />\n              <ThemedText style={styles.sosButtonText}>SOS</ThemedText>\n            </Pressable>\n          </View>\n        </View>\n      </View>\n\n      <SOSConfirmModal\n        visible={showSOSModal}\n        onConfirm={handleConfirmSOS}\n        onCancel={() => setShowSOSModal(false)}\n        isLoading={isSendingSOS}\n      />\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  content: {\n    flex: 1,\n    paddingHorizontal: Spacing.lg,\n  },\n  timerSection: {\n    alignItems: \"center\",\n    marginBottom: Spacing[\"2xl\"],\n  },\n  timerCircle: {\n    width: 200,\n    height: 200,\n    borderRadius: 100,\n    borderWidth: 8,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  timerText: {\n    fontSize: 40,\n    fontWeight: \"700\",\n    fontVariant: [\"tabular-nums\"],\n  },\n  timerLabel: {\n    ...Typography.small,\n    marginTop: Spacing.xs,\n  },\n  overdueWarning: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.sm,\n    paddingVertical: Spacing.md,\n    paddingHorizontal: Spacing.lg,\n    borderRadius: BorderRadius.sm,\n    marginTop: Spacing.lg,\n  },\n  overdueText: {\n    ...Typography.body,\n    fontWeight: \"500\",\n  },\n  journeyCard: {\n    padding: Spacing.lg,\n    marginBottom: Spacing[\"2xl\"],\n  },\n  journeyRow: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  journeyDot: {\n    width: 12,\n    height: 12,\n    borderRadius: 6,\n  },\n  journeyInfo: {\n    flex: 1,\n    marginLeft: Spacing.md,\n  },\n  journeyLabel: {\n    ...Typography.small,\n    marginBottom: Spacing.xs,\n  },\n  journeyValue: {\n    ...Typography.body,\n    fontWeight: \"500\",\n  },\n  journeyDivider: {\n    width: 2,\n    height: 24,\n    marginLeft: 5,\n    marginVertical: Spacing.sm,\n  },\n  noteSection: {\n    flexDirection: \"row\",\n    alignItems: \"flex-start\",\n    gap: Spacing.sm,\n    marginTop: Spacing.lg,\n    padding: Spacing.md,\n    borderRadius: BorderRadius.xs,\n  },\n  noteText: {\n    ...Typography.small,\n    flex: 1,\n  },\n  buttonSection: {\n    marginTop: \"auto\",\n  },\n  arrivedButton: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    height: 56,\n    borderRadius: BorderRadius.md,\n    gap: Spacing.sm,\n    marginBottom: Spacing.md,\n  },\n  arrivedButtonText: {\n    color: \"#FFF\",\n    ...Typography.body,\n    fontWeight: \"600\",\n    fontSize: 18,\n  },\n  secondaryButtons: {\n    flexDirection: \"row\",\n    gap: Spacing.md,\n  },\n  cancelButton: {\n    flex: 1,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    height: 48,\n    borderRadius: BorderRadius.sm,\n    borderWidth: 2,\n    gap: Spacing.sm,\n  },\n  cancelButtonText: {\n    ...Typography.body,\n    fontWeight: \"500\",\n  },\n  sosButton: {\n    flex: 1,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    height: 48,\n    borderRadius: BorderRadius.sm,\n    gap: Spacing.sm,\n  },\n  sosButtonText: {\n    color: \"#FFF\",\n    ...Typography.body,\n    fontWeight: \"600\",\n  },\n});\n","path":null,"size_bytes":12211,"size_tokens":null},"client/screens/JourneyHistoryScreen.tsx":{"content":"import React, { useState, useCallback } from \"react\";\nimport {\n  View,\n  StyleSheet,\n  FlatList,\n  RefreshControl,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useBottomTabBarHeight } from \"@react-navigation/bottom-tabs\";\nimport { useFocusEffect } from \"@react-navigation/native\";\nimport { Feather } from \"@expo/vector-icons\";\nimport { useQuery } from \"@tanstack/react-query\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { Card } from \"@/components/Card\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useUserStore } from \"@/stores/userStore\";\nimport { Spacing, BorderRadius, Typography } from \"@/constants/theme\";\nimport type { Journey } from \"@shared/schema\";\n\nexport default function JourneyHistoryScreen() {\n  const insets = useSafeAreaInsets();\n  const tabBarHeight = useBottomTabBarHeight();\n  const { theme } = useTheme();\n  const { userId } = useUserStore();\n\n  const { data: journeys = [], isLoading, refetch } = useQuery<Journey[]>({\n    queryKey: [\"/api/users\", userId, \"journeys\"],\n    enabled: !!userId,\n  });\n\n  useFocusEffect(\n    useCallback(() => {\n      if (userId) {\n        refetch();\n      }\n    }, [userId])\n  );\n\n  const formatDate = (date: Date | string) => {\n    const d = new Date(date);\n    return d.toLocaleDateString(\"en-US\", {\n      month: \"short\",\n      day: \"numeric\",\n      year: \"numeric\",\n    });\n  };\n\n  const formatTime = (date: Date | string) => {\n    const d = new Date(date);\n    return d.toLocaleTimeString(\"en-US\", {\n      hour: \"numeric\",\n      minute: \"2-digit\",\n    });\n  };\n\n  const getStatusInfo = (status: string) => {\n    switch (status) {\n      case \"completed\":\n        return { icon: \"check-circle\", color: theme.success, label: \"Completed\" };\n      case \"cancelled\":\n        return { icon: \"x-circle\", color: theme.textSecondary, label: \"Cancelled\" };\n      case \"active\":\n        return { icon: \"navigation\", color: theme.primary, label: \"Active\" };\n      default:\n        return { icon: \"circle\", color: theme.textSecondary, label: status };\n    }\n  };\n\n  const completedJourneys = journeys.filter((j) => j.status !== \"active\");\n\n  const renderItem = ({ item }: { item: Journey }) => {\n    const statusInfo = getStatusInfo(item.status);\n\n    return (\n      <Card style={styles.journeyCard}>\n        <View style={styles.journeyHeader}>\n          <View style={[styles.statusIcon, { backgroundColor: statusInfo.color + \"20\" }]}>\n            <Feather name={statusInfo.icon as any} size={20} color={statusInfo.color} />\n          </View>\n          <View style={styles.journeyInfo}>\n            <ThemedText style={styles.destination}>{item.destination}</ThemedText>\n            <ThemedText style={[styles.dateText, { color: theme.textSecondary }]}>\n              {formatDate(item.createdAt!)} at {formatTime(item.createdAt!)}\n            </ThemedText>\n          </View>\n          <View style={[styles.statusBadge, { backgroundColor: statusInfo.color + \"20\" }]}>\n            <ThemedText style={[styles.statusText, { color: statusInfo.color }]}>\n              {statusInfo.label}\n            </ThemedText>\n          </View>\n        </View>\n\n        <View style={styles.journeyDetails}>\n          <View style={styles.detailRow}>\n            <Feather name=\"map-pin\" size={14} color={theme.textSecondary} />\n            <ThemedText style={[styles.detailText, { color: theme.textSecondary }]}>\n              From: {item.startLocation}\n            </ThemedText>\n          </View>\n          <View style={styles.detailRow}>\n            <Feather name=\"clock\" size={14} color={theme.textSecondary} />\n            <ThemedText style={[styles.detailText, { color: theme.textSecondary }]}>\n              Duration: {item.estimatedDuration} min\n            </ThemedText>\n          </View>\n        </View>\n\n        {item.note ? (\n          <View style={[styles.noteBox, { backgroundColor: theme.backgroundSecondary }]}>\n            <ThemedText style={[styles.noteText, { color: theme.textSecondary }]}>\n              {item.note}\n            </ThemedText>\n          </View>\n        ) : null}\n      </Card>\n    );\n  };\n\n  const renderEmpty = () => (\n    <View style={styles.emptyContainer}>\n      <View style={[styles.emptyIcon, { backgroundColor: theme.primary + \"20\" }]}>\n        <Feather name=\"map\" size={48} color={theme.primary} />\n      </View>\n      <ThemedText style={styles.emptyTitle}>No Journeys Yet</ThemedText>\n      <ThemedText style={[styles.emptyText, { color: theme.textSecondary }]}>\n        Start your first journey from the home screen to see your history here.\n      </ThemedText>\n    </View>\n  );\n\n  return (\n    <ThemedView style={styles.container}>\n      <FlatList\n        data={completedJourneys}\n        keyExtractor={(item) => item.id}\n        renderItem={renderItem}\n        contentContainerStyle={[\n          styles.listContent,\n          { paddingTop: insets.top + Spacing[\"3xl\"], paddingBottom: tabBarHeight + Spacing.xl },\n          completedJourneys.length === 0 && styles.emptyList,\n        ]}\n        scrollIndicatorInsets={{ bottom: insets.bottom }}\n        ListHeaderComponent={\n          <ThemedText style={styles.headerTitle}>Journey History</ThemedText>\n        }\n        ListEmptyComponent={renderEmpty}\n        refreshControl={\n          <RefreshControl\n            refreshing={isLoading}\n            onRefresh={refetch}\n            tintColor={theme.primary}\n          />\n        }\n      />\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  listContent: {\n    paddingHorizontal: Spacing.lg,\n  },\n  emptyList: {\n    flexGrow: 1,\n  },\n  headerTitle: {\n    ...Typography.h2,\n    marginBottom: Spacing.lg,\n  },\n  journeyCard: {\n    marginBottom: Spacing.md,\n    padding: Spacing.lg,\n  },\n  journeyHeader: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  statusIcon: {\n    width: 40,\n    height: 40,\n    borderRadius: 20,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  journeyInfo: {\n    flex: 1,\n    marginLeft: Spacing.md,\n  },\n  destination: {\n    ...Typography.body,\n    fontWeight: \"600\",\n  },\n  dateText: {\n    ...Typography.small,\n  },\n  statusBadge: {\n    paddingHorizontal: Spacing.sm,\n    paddingVertical: Spacing.xs,\n    borderRadius: BorderRadius.xs,\n  },\n  statusText: {\n    ...Typography.small,\n    fontWeight: \"500\",\n  },\n  journeyDetails: {\n    marginTop: Spacing.md,\n    gap: Spacing.xs,\n  },\n  detailRow: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.sm,\n  },\n  detailText: {\n    ...Typography.small,\n  },\n  noteBox: {\n    marginTop: Spacing.md,\n    padding: Spacing.md,\n    borderRadius: BorderRadius.xs,\n  },\n  noteText: {\n    ...Typography.small,\n    fontStyle: \"italic\",\n  },\n  emptyContainer: {\n    flex: 1,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    paddingHorizontal: Spacing[\"2xl\"],\n  },\n  emptyIcon: {\n    width: 96,\n    height: 96,\n    borderRadius: 48,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    marginBottom: Spacing.lg,\n  },\n  emptyTitle: {\n    ...Typography.h3,\n    textAlign: \"center\",\n    marginBottom: Spacing.sm,\n  },\n  emptyText: {\n    ...Typography.body,\n    textAlign: \"center\",\n  },\n});\n","path":null,"size_bytes":7260,"size_tokens":null},"replit.md":{"content":"# Safe Connect - Personal Safety App\n\n## Overview\n\nSafe Connect is a personal safety mobile application built with React Native (Expo) and Express.js. The app enables users to track journeys, send emergency SOS alerts to designated contacts, and store personal identification details that can help in emergency situations.\n\nCore features include:\n- **Journey Tracking**: Users can start monitored journeys with expected arrival times, receiving alerts if they don't check in\n- **SOS Emergency Alerts**: One-tap emergency alerts that send SMS notifications with location data to emergency contacts\n- **Personal Profile**: Storage of physical characteristics and identifying information for emergency situations\n- **Emergency Contacts**: Management of trusted contacts who receive alerts during emergencies\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n- **Framework**: React Native with Expo SDK 54\n- **Navigation**: React Navigation with native stack and bottom tabs\n  - Tab Navigation (3 tabs): Home, Journey History, Profile\n  - Modal presentation for Active Journey screen\n- **State Management**: Zustand with AsyncStorage persistence for user data\n- **Data Fetching**: TanStack Query (React Query) for server state\n- **Styling**: React Native StyleSheet with custom theming (light/dark mode support)\n- **Animations**: React Native Reanimated for gesture-based interactions\n- **Path Aliases**: `@/` maps to `./client`, `@shared/` maps to `./shared`\n\n### Backend Architecture\n- **Framework**: Express.js with TypeScript\n- **Database**: PostgreSQL with Drizzle ORM\n- **Schema Location**: `shared/schema.ts` (shared between client and server)\n- **API Pattern**: RESTful JSON API at `/api/*` routes\n- **Validation**: Zod schemas generated from Drizzle schemas via `drizzle-zod`\n\n### Data Model\nFour main entities defined in `shared/schema.ts`:\n1. **Users**: Profile data including physical characteristics (height, weight, skin tone, eye color, distinguishing features, medical info, code word)\n2. **Emergency Contacts**: Linked contacts with phone, relationship, and primary designation\n3. **Journeys**: Trip tracking with start/end locations, timestamps, status, and coordinates\n4. **Alerts**: Emergency alert records with type, location, and contact notification status\n\n### Authentication\n- Currently uses client-side user ID persistence (no OAuth implemented yet)\n- Designed for future Apple Sign-In (iOS) and Google Sign-In integration\n- Onboarding flow creates user profile and initial emergency contact\n\n### Build System\n- **Development**: Expo dev server with Metro bundler, separate Express server\n- **Production**: Static web build with esbuild for server bundling\n- **Database Migrations**: Drizzle Kit for schema management\n\n## External Dependencies\n\n### SMS Notifications\n- **Vonage (Nexmo)**: SMS API for sending emergency alerts\n- Environment variables: `VONAGE_API_KEY`, `VONAGE_API_SECRET`\n- Features: SOS alerts, journey start/complete/overdue notifications, OTP verification\n\n### Database\n- **PostgreSQL**: Primary data store\n- Environment variable: `DATABASE_URL`\n- ORM: Drizzle with `drizzle-orm/node-postgres`\n\n### Location Services\n- **Expo Location**: Device location for journey tracking and SOS alerts\n- Permissions: `ACCESS_FINE_LOCATION`, `ACCESS_COARSE_LOCATION` (Android), `NSLocationWhenInUseUsageDescription`, `NSLocationAlwaysUsageDescription` (iOS)\n\n### Key Dependencies\n- `expo-location`: GPS/location services\n- `expo-haptics`: Tactile feedback for SOS and actions\n- `@vonage/server-sdk`: SMS delivery\n- `drizzle-orm` + `pg`: Database operations\n- `zustand`: Client state management with persistence\n- `@tanstack/react-query`: Server state and caching","path":null,"size_bytes":3772,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/components/KeyboardAwareScrollViewCompat.tsx":{"content":"import { Platform, ScrollView, ScrollViewProps } from \"react-native\";\nimport {\n  KeyboardAwareScrollView,\n  KeyboardAwareScrollViewProps,\n} from \"react-native-keyboard-controller\";\n\ntype Props = KeyboardAwareScrollViewProps & ScrollViewProps;\n\n/**\n * KeyboardAwareScrollView that falls back to ScrollView on web.\n * Use this for any screen containing text inputs.\n */\nexport function KeyboardAwareScrollViewCompat({\n  children,\n  keyboardShouldPersistTaps = \"handled\",\n  ...props\n}: Props) {\n  if (Platform.OS === \"web\") {\n    return (\n      <ScrollView\n        keyboardShouldPersistTaps={keyboardShouldPersistTaps}\n        {...props}\n      >\n        {children}\n      </ScrollView>\n    );\n  }\n\n  return (\n    <KeyboardAwareScrollView\n      keyboardShouldPersistTaps={keyboardShouldPersistTaps}\n      {...props}\n    >\n      {children}\n    </KeyboardAwareScrollView>\n  );\n}\n","path":null,"size_bytes":872,"size_tokens":null},"shared/schema.ts":{"content":"import { sql, relations } from \"drizzle-orm\";\nimport { pgTable, text, varchar, boolean, timestamp, integer } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\")\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull().default(\"User\"),\n  phone: text(\"phone\").notNull(),\n  phoneVerified: boolean(\"phone_verified\").default(false),\n  phoneVerifiedAt: timestamp(\"phone_verified_at\"),\n  height: text(\"height\"),\n  weight: text(\"weight\"),\n  skinTone: text(\"skin_tone\"),\n  eyeColor: text(\"eye_color\"),\n  distinguishingFeatures: text(\"distinguishing_features\"),\n  medicalInfo: text(\"medical_info\"),\n  codeWord: text(\"code_word\"),\n  avatarIndex: integer(\"avatar_index\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const usersRelations = relations(users, ({ many }) => ({\n  emergencyContacts: many(emergencyContacts),\n  journeys: many(journeys),\n  alerts: many(alerts),\n}));\n\nexport const emergencyContacts = pgTable(\"emergency_contacts\", {\n  id: varchar(\"id\")\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  name: text(\"name\").notNull(),\n  phone: text(\"phone\").notNull(),\n  relationship: text(\"relationship\").notNull(),\n  isPrimary: boolean(\"is_primary\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const emergencyContactsRelations = relations(emergencyContacts, ({ one }) => ({\n  user: one(users, {\n    fields: [emergencyContacts.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const journeys = pgTable(\"journeys\", {\n  id: varchar(\"id\")\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  startLocation: text(\"start_location\").notNull(),\n  startLatitude: text(\"start_latitude\"),\n  startLongitude: text(\"start_longitude\"),\n  destination: text(\"destination\").notNull(),\n  estimatedDuration: integer(\"estimated_duration\").notNull(),\n  bufferTime: integer(\"buffer_time\").default(10),\n  note: text(\"note\"),\n  status: text(\"status\").notNull().default(\"active\"),\n  expectedArrival: timestamp(\"expected_arrival\").notNull(),\n  completedAt: timestamp(\"completed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const journeysRelations = relations(journeys, ({ one, many }) => ({\n  user: one(users, {\n    fields: [journeys.userId],\n    references: [users.id],\n  }),\n  alerts: many(alerts),\n}));\n\nexport const alerts = pgTable(\"alerts\", {\n  id: varchar(\"id\")\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  journeyId: varchar(\"journey_id\").references(() => journeys.id, { onDelete: \"set null\" }),\n  type: text(\"type\").notNull(),\n  latitude: text(\"latitude\"),\n  longitude: text(\"longitude\"),\n  status: text(\"status\").notNull().default(\"sent\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  resolvedAt: timestamp(\"resolved_at\"),\n});\n\nexport const alertsRelations = relations(alerts, ({ one }) => ({\n  user: one(users, {\n    fields: [alerts.userId],\n    references: [users.id],\n  }),\n  journey: one(journeys, {\n    fields: [alerts.journeyId],\n    references: [journeys.id],\n  }),\n}));\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  name: true,\n  phone: true,\n  phoneVerified: true,\n  height: true,\n  weight: true,\n  skinTone: true,\n  eyeColor: true,\n  distinguishingFeatures: true,\n  medicalInfo: true,\n  codeWord: true,\n  avatarIndex: true,\n});\n\nexport const insertEmergencyContactSchema = createInsertSchema(emergencyContacts).pick({\n  userId: true,\n  name: true,\n  phone: true,\n  relationship: true,\n  isPrimary: true,\n});\n\nexport const insertJourneySchema = createInsertSchema(journeys).pick({\n  userId: true,\n  startLocation: true,\n  startLatitude: true,\n  startLongitude: true,\n  destination: true,\n  estimatedDuration: true,\n  bufferTime: true,\n  note: true,\n  status: true,\n  expectedArrival: true,\n});\n\nexport const insertAlertSchema = createInsertSchema(alerts).pick({\n  userId: true,\n  journeyId: true,\n  type: true,\n  latitude: true,\n  longitude: true,\n  status: true,\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\nexport type InsertEmergencyContact = z.infer<typeof insertEmergencyContactSchema>;\nexport type EmergencyContact = typeof emergencyContacts.$inferSelect;\nexport type InsertJourney = z.infer<typeof insertJourneySchema>;\nexport type Journey = typeof journeys.$inferSelect;\nexport type InsertAlert = z.infer<typeof insertAlertSchema>;\nexport type Alert = typeof alerts.$inferSelect;\n","path":null,"size_bytes":4811,"size_tokens":null},"client/screens/EmergencyContactsScreen.tsx":{"content":"import React, { useCallback } from \"react\";\nimport {\n  View,\n  StyleSheet,\n  Pressable,\n  FlatList,\n  Alert,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useHeaderHeight } from \"@react-navigation/elements\";\nimport { useNavigation, useFocusEffect } from \"@react-navigation/native\";\nimport type { NativeStackNavigationProp } from \"@react-navigation/native-stack\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as Haptics from \"expo-haptics\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { Card } from \"@/components/Card\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useUserStore } from \"@/stores/userStore\";\nimport { Spacing, BorderRadius, Typography } from \"@/constants/theme\";\nimport type { RootStackParamList } from \"@/navigation/RootStackNavigator\";\nimport type { EmergencyContact } from \"@shared/schema\";\n\nexport default function EmergencyContactsScreen() {\n  const insets = useSafeAreaInsets();\n  const headerHeight = useHeaderHeight();\n  const navigation = useNavigation<NativeStackNavigationProp<RootStackParamList>>();\n  const { theme } = useTheme();\n  const { emergencyContacts, fetchEmergencyContacts, deleteEmergencyContact } = useUserStore();\n\n  useFocusEffect(\n    useCallback(() => {\n      fetchEmergencyContacts();\n    }, [])\n  );\n\n  const handleDelete = (contact: EmergencyContact) => {\n    Alert.alert(\n      \"Delete Contact\",\n      `Are you sure you want to remove ${contact.name} from your emergency contacts?`,\n      [\n        { text: \"Cancel\", style: \"cancel\" },\n        {\n          text: \"Delete\",\n          style: \"destructive\",\n          onPress: async () => {\n            await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n            await deleteEmergencyContact(contact.id);\n          },\n        },\n      ]\n    );\n  };\n\n  const renderItem = ({ item }: { item: EmergencyContact }) => (\n    <Card style={styles.contactCard}>\n      <View style={styles.contactContent}>\n        <View style={[styles.avatarCircle, { backgroundColor: theme.primary + \"20\" }]}>\n          <Feather name=\"user\" size={24} color={theme.primary} />\n        </View>\n        <View style={styles.contactInfo}>\n          <View style={styles.nameRow}>\n            <ThemedText style={styles.contactName}>{item.name}</ThemedText>\n            {item.isPrimary && (\n              <View style={[styles.primaryBadge, { backgroundColor: theme.primary + \"20\" }]}>\n                <ThemedText style={[styles.primaryText, { color: theme.primary }]}>\n                  Primary\n                </ThemedText>\n              </View>\n            )}\n          </View>\n          <ThemedText style={[styles.contactPhone, { color: theme.textSecondary }]}>\n            {item.phone}\n          </ThemedText>\n          <ThemedText style={[styles.contactRelationship, { color: theme.textSecondary }]}>\n            {item.relationship}\n          </ThemedText>\n        </View>\n        <Pressable\n          style={[styles.deleteButton, { backgroundColor: theme.dangerLight }]}\n          onPress={() => handleDelete(item)}\n        >\n          <Feather name=\"trash-2\" size={18} color={theme.danger} />\n        </Pressable>\n      </View>\n    </Card>\n  );\n\n  const renderEmpty = () => (\n    <View style={styles.emptyContainer}>\n      <View style={[styles.emptyIcon, { backgroundColor: theme.danger + \"20\" }]}>\n        <Feather name=\"users\" size={48} color={theme.danger} />\n      </View>\n      <ThemedText style={styles.emptyTitle}>No Emergency Contacts</ThemedText>\n      <ThemedText style={[styles.emptyText, { color: theme.textSecondary }]}>\n        Add people who should be notified in case of an emergency.\n      </ThemedText>\n    </View>\n  );\n\n  return (\n    <ThemedView style={styles.container}>\n      <FlatList\n        data={emergencyContacts}\n        keyExtractor={(item) => item.id}\n        renderItem={renderItem}\n        contentContainerStyle={[\n          styles.listContent,\n          { paddingTop: headerHeight + Spacing.xl, paddingBottom: insets.bottom + Spacing[\"3xl\"] },\n          emergencyContacts.length === 0 && styles.emptyList,\n        ]}\n        scrollIndicatorInsets={{ bottom: insets.bottom }}\n        ListEmptyComponent={renderEmpty}\n      />\n\n      <View style={[styles.footer, { paddingBottom: insets.bottom + Spacing.lg }]}>\n        <Pressable\n          style={[styles.addButton, { backgroundColor: theme.primary }]}\n          onPress={() => {\n            Haptics.selectionAsync();\n            navigation.navigate(\"AddContact\");\n          }}\n        >\n          <Feather name=\"plus\" size={24} color=\"#FFF\" />\n          <ThemedText style={styles.addButtonText}>Add Contact</ThemedText>\n        </Pressable>\n      </View>\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  listContent: {\n    paddingHorizontal: Spacing.lg,\n  },\n  emptyList: {\n    flexGrow: 1,\n  },\n  contactCard: {\n    marginBottom: Spacing.md,\n    padding: Spacing.lg,\n  },\n  contactContent: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  avatarCircle: {\n    width: 48,\n    height: 48,\n    borderRadius: 24,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  contactInfo: {\n    flex: 1,\n    marginLeft: Spacing.md,\n  },\n  nameRow: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.sm,\n  },\n  contactName: {\n    ...Typography.body,\n    fontWeight: \"600\",\n  },\n  primaryBadge: {\n    paddingHorizontal: Spacing.sm,\n    paddingVertical: 2,\n    borderRadius: BorderRadius.xs,\n  },\n  primaryText: {\n    fontSize: 11,\n    fontWeight: \"600\",\n  },\n  contactPhone: {\n    ...Typography.body,\n    marginTop: Spacing.xs,\n  },\n  contactRelationship: {\n    ...Typography.small,\n  },\n  deleteButton: {\n    width: 40,\n    height: 40,\n    borderRadius: 20,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  emptyContainer: {\n    flex: 1,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    paddingHorizontal: Spacing[\"2xl\"],\n  },\n  emptyIcon: {\n    width: 96,\n    height: 96,\n    borderRadius: 48,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    marginBottom: Spacing.lg,\n  },\n  emptyTitle: {\n    ...Typography.h3,\n    textAlign: \"center\",\n    marginBottom: Spacing.sm,\n  },\n  emptyText: {\n    ...Typography.body,\n    textAlign: \"center\",\n  },\n  footer: {\n    paddingHorizontal: Spacing.lg,\n    paddingTop: Spacing.md,\n    borderTopWidth: 1,\n    borderTopColor: \"transparent\",\n  },\n  addButton: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    height: Spacing.buttonHeight,\n    borderRadius: BorderRadius.md,\n    gap: Spacing.sm,\n  },\n  addButtonText: {\n    color: \"#FFF\",\n    ...Typography.body,\n    fontWeight: \"600\",\n  },\n});\n","path":null,"size_bytes":6785,"size_tokens":null},"server/index.ts":{"content":"import express from \"express\";\nimport type { Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport * as fs from \"fs\";\nimport * as path from \"path\";\n\nconst app = express();\nconst log = console.log;\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\nfunction setupCors(app: express.Application) {\n  app.use((req, res, next) => {\n    const origins = new Set<string>();\n\n    if (process.env.REPLIT_DEV_DOMAIN) {\n      origins.add(`https://${process.env.REPLIT_DEV_DOMAIN}`);\n    }\n\n    if (process.env.REPLIT_DOMAINS) {\n      process.env.REPLIT_DOMAINS.split(\",\").forEach((d) => {\n        origins.add(`https://${d.trim()}`);\n      });\n    }\n\n    const origin = req.header(\"origin\");\n\n    if (origin && origins.has(origin)) {\n      res.header(\"Access-Control-Allow-Origin\", origin);\n      res.header(\n        \"Access-Control-Allow-Methods\",\n        \"GET, POST, PUT, DELETE, OPTIONS\",\n      );\n      res.header(\"Access-Control-Allow-Headers\", \"Content-Type\");\n      res.header(\"Access-Control-Allow-Credentials\", \"true\");\n    }\n\n    if (req.method === \"OPTIONS\") {\n      return res.sendStatus(200);\n    }\n\n    next();\n  });\n}\n\nfunction setupBodyParsing(app: express.Application) {\n  app.use(\n    express.json({\n      verify: (req, _res, buf) => {\n        req.rawBody = buf;\n      },\n    }),\n  );\n\n  app.use(express.urlencoded({ extended: false }));\n}\n\nfunction setupRequestLogging(app: express.Application) {\n  app.use((req, res, next) => {\n    const start = Date.now();\n    const path = req.path;\n    let capturedJsonResponse: Record<string, unknown> | undefined = undefined;\n\n    const originalResJson = res.json;\n    res.json = function (bodyJson, ...args) {\n      capturedJsonResponse = bodyJson;\n      return originalResJson.apply(res, [bodyJson, ...args]);\n    };\n\n    res.on(\"finish\", () => {\n      if (!path.startsWith(\"/api\")) return;\n\n      const duration = Date.now() - start;\n\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"\";\n      }\n\n      log(logLine);\n    });\n\n    next();\n  });\n}\n\nfunction getAppName(): string {\n  try {\n    const appJsonPath = path.resolve(process.cwd(), \"app.json\");\n    const appJsonContent = fs.readFileSync(appJsonPath, \"utf-8\");\n    const appJson = JSON.parse(appJsonContent);\n    return appJson.expo?.name || \"App Landing Page\";\n  } catch {\n    return \"App Landing Page\";\n  }\n}\n\nfunction serveExpoManifest(platform: string, res: Response) {\n  const manifestPath = path.resolve(\n    process.cwd(),\n    \"static-build\",\n    platform,\n    \"manifest.json\",\n  );\n\n  if (!fs.existsSync(manifestPath)) {\n    return res\n      .status(404)\n      .json({ error: `Manifest not found for platform: ${platform}` });\n  }\n\n  res.setHeader(\"expo-protocol-version\", \"1\");\n  res.setHeader(\"expo-sfv-version\", \"0\");\n  res.setHeader(\"content-type\", \"application/json\");\n\n  const manifest = fs.readFileSync(manifestPath, \"utf-8\");\n  res.send(manifest);\n}\n\nfunction serveLandingPage({\n  req,\n  res,\n  landingPageTemplate,\n  appName,\n}: {\n  req: Request;\n  res: Response;\n  landingPageTemplate: string;\n  appName: string;\n}) {\n  const forwardedProto = req.header(\"x-forwarded-proto\");\n  const protocol = forwardedProto || req.protocol || \"https\";\n  const forwardedHost = req.header(\"x-forwarded-host\");\n  const host = forwardedHost || req.get(\"host\");\n  const baseUrl = `${protocol}://${host}`;\n  const expsUrl = `${host}`;\n\n  log(`baseUrl`, baseUrl);\n  log(`expsUrl`, expsUrl);\n\n  const html = landingPageTemplate\n    .replace(/BASE_URL_PLACEHOLDER/g, baseUrl)\n    .replace(/EXPS_URL_PLACEHOLDER/g, expsUrl)\n    .replace(/APP_NAME_PLACEHOLDER/g, appName);\n\n  res.setHeader(\"Content-Type\", \"text/html; charset=utf-8\");\n  res.status(200).send(html);\n}\n\nfunction configureExpoAndLanding(app: express.Application) {\n  const templatePath = path.resolve(\n    process.cwd(),\n    \"server\",\n    \"templates\",\n    \"landing-page.html\",\n  );\n  const landingPageTemplate = fs.readFileSync(templatePath, \"utf-8\");\n  const appName = getAppName();\n\n  log(\"Serving static Expo files with dynamic manifest routing\");\n\n  app.use((req: Request, res: Response, next: NextFunction) => {\n    if (req.path.startsWith(\"/api\")) {\n      return next();\n    }\n\n    if (req.path !== \"/\" && req.path !== \"/manifest\") {\n      return next();\n    }\n\n    const platform = req.header(\"expo-platform\");\n    if (platform && (platform === \"ios\" || platform === \"android\")) {\n      return serveExpoManifest(platform, res);\n    }\n\n    if (req.path === \"/\") {\n      return serveLandingPage({\n        req,\n        res,\n        landingPageTemplate,\n        appName,\n      });\n    }\n\n    next();\n  });\n\n  app.use(\"/assets\", express.static(path.resolve(process.cwd(), \"assets\")));\n  app.use(express.static(path.resolve(process.cwd(), \"static-build\")));\n\n  log(\"Expo routing: Checking expo-platform header on / and /manifest\");\n}\n\nfunction setupErrorHandler(app: express.Application) {\n  app.use((err: unknown, _req: Request, res: Response, _next: NextFunction) => {\n    const error = err as {\n      status?: number;\n      statusCode?: number;\n      message?: string;\n    };\n\n    const status = error.status || error.statusCode || 500;\n    const message = error.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n\n    throw err;\n  });\n}\n\n(async () => {\n  setupCors(app);\n  setupBodyParsing(app);\n  setupRequestLogging(app);\n\n  configureExpoAndLanding(app);\n\n  const server = await registerRoutes(app);\n\n  setupErrorHandler(app);\n\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  server.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`express server serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":5949,"size_tokens":null},"client/screens/AddContactScreen.tsx":{"content":"import React, { useState } from \"react\";\nimport {\n  View,\n  TextInput,\n  StyleSheet,\n  Pressable,\n  Alert,\n  Switch,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useHeaderHeight } from \"@react-navigation/elements\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as Haptics from \"expo-haptics\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { KeyboardAwareScrollViewCompat } from \"@/components/KeyboardAwareScrollViewCompat\";\nimport { Card } from \"@/components/Card\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useUserStore } from \"@/stores/userStore\";\nimport { Spacing, BorderRadius, Typography } from \"@/constants/theme\";\n\nconst RELATIONSHIP_OPTIONS = [\"Mom\", \"Dad\", \"Spouse\", \"Partner\", \"Sibling\", \"Friend\", \"Roommate\", \"Other\"];\n\nexport default function AddContactScreen() {\n  const insets = useSafeAreaInsets();\n  const headerHeight = useHeaderHeight();\n  const navigation = useNavigation();\n  const { theme } = useTheme();\n  const { createEmergencyContact, emergencyContacts } = useUserStore();\n\n  const [name, setName] = useState(\"\");\n  const [phone, setPhone] = useState(\"\");\n  const [relationship, setRelationship] = useState(\"\");\n  const [isPrimary, setIsPrimary] = useState(emergencyContacts.length === 0);\n  const [isLoading, setIsLoading] = useState(false);\n\n  const handleSave = async () => {\n    if (!name.trim()) {\n      Alert.alert(\"Name Required\", \"Please enter the contact's name.\");\n      return;\n    }\n    if (!phone.trim()) {\n      Alert.alert(\"Phone Required\", \"Please enter the contact's phone number.\");\n      return;\n    }\n    if (!relationship.trim()) {\n      Alert.alert(\"Relationship Required\", \"Please select or enter the relationship.\");\n      return;\n    }\n\n    await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n    setIsLoading(true);\n\n    try {\n      await createEmergencyContact({\n        name: name.trim(),\n        phone: phone.trim(),\n        relationship: relationship.trim(),\n        isPrimary,\n        userId: \"\",\n      });\n      Alert.alert(\"Success\", \"Emergency contact added successfully!\");\n      navigation.goBack();\n    } catch (error) {\n      Alert.alert(\"Error\", \"Failed to add contact. Please try again.\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <ThemedView style={styles.container}>\n      <KeyboardAwareScrollViewCompat\n        style={{ flex: 1 }}\n        contentContainerStyle={[\n          styles.scrollContent,\n          { paddingTop: headerHeight + Spacing.xl, paddingBottom: insets.bottom + Spacing[\"2xl\"] },\n        ]}\n        scrollIndicatorInsets={{ bottom: insets.bottom }}\n      >\n        <Card style={styles.formCard}>\n          <View style={styles.inputContainer}>\n            <ThemedText style={[styles.inputLabel, { color: theme.textSecondary }]}>\n              Contact Name *\n            </ThemedText>\n            <TextInput\n              style={[\n                styles.input,\n                {\n                  backgroundColor: theme.backgroundSecondary,\n                  color: theme.text,\n                  borderColor: theme.border,\n                },\n              ]}\n              placeholder=\"e.g., Mom\"\n              placeholderTextColor={theme.textSecondary}\n              value={name}\n              onChangeText={setName}\n              autoFocus\n              autoCapitalize=\"words\"\n            />\n          </View>\n\n          <View style={styles.inputContainer}>\n            <ThemedText style={[styles.inputLabel, { color: theme.textSecondary }]}>\n              Phone Number *\n            </ThemedText>\n            <TextInput\n              style={[\n                styles.input,\n                {\n                  backgroundColor: theme.backgroundSecondary,\n                  color: theme.text,\n                  borderColor: theme.border,\n                },\n              ]}\n              placeholder=\"e.g., (555) 123-4567\"\n              placeholderTextColor={theme.textSecondary}\n              value={phone}\n              onChangeText={setPhone}\n              keyboardType=\"phone-pad\"\n            />\n          </View>\n\n          <View style={styles.inputContainer}>\n            <ThemedText style={[styles.inputLabel, { color: theme.textSecondary }]}>\n              Relationship *\n            </ThemedText>\n            <View style={styles.relationshipGrid}>\n              {RELATIONSHIP_OPTIONS.map((option) => (\n                <Pressable\n                  key={option}\n                  style={[\n                    styles.relationshipButton,\n                    { backgroundColor: theme.backgroundSecondary },\n                    relationship === option && { backgroundColor: theme.primary },\n                  ]}\n                  onPress={() => {\n                    setRelationship(option);\n                    Haptics.selectionAsync();\n                  }}\n                >\n                  <ThemedText\n                    style={[\n                      styles.relationshipText,\n                      relationship === option && { color: \"#FFF\" },\n                    ]}\n                  >\n                    {option}\n                  </ThemedText>\n                </Pressable>\n              ))}\n            </View>\n            {relationship === \"Other\" && (\n              <TextInput\n                style={[\n                  styles.input,\n                  {\n                    backgroundColor: theme.backgroundSecondary,\n                    color: theme.text,\n                    borderColor: theme.border,\n                    marginTop: Spacing.md,\n                  },\n                ]}\n                placeholder=\"Specify relationship\"\n                placeholderTextColor={theme.textSecondary}\n                value={relationship === \"Other\" ? \"\" : relationship}\n                onChangeText={setRelationship}\n              />\n            )}\n          </View>\n        </Card>\n\n        <Card style={styles.primaryCard}>\n          <View style={styles.primaryRow}>\n            <View style={styles.primaryInfo}>\n              <ThemedText style={styles.primaryTitle}>Set as Primary Contact</ThemedText>\n              <ThemedText style={[styles.primarySubtitle, { color: theme.textSecondary }]}>\n                This person will be contacted first in emergencies\n              </ThemedText>\n            </View>\n            <Switch\n              value={isPrimary}\n              onValueChange={(value) => {\n                setIsPrimary(value);\n                Haptics.selectionAsync();\n              }}\n              trackColor={{ false: theme.border, true: theme.primary }}\n            />\n          </View>\n        </Card>\n\n        <View style={styles.infoBox}>\n          <Feather name=\"info\" size={16} color={theme.primary} />\n          <ThemedText style={[styles.infoText, { color: theme.textSecondary }]}>\n            Emergency contacts will receive alerts with your location when you trigger an SOS or miss a check-in.\n          </ThemedText>\n        </View>\n\n        <Pressable\n          style={[\n            styles.saveButton,\n            { backgroundColor: theme.primary },\n            isLoading && { opacity: 0.6 },\n          ]}\n          onPress={handleSave}\n          disabled={isLoading}\n        >\n          <Feather name=\"user-plus\" size={20} color=\"#FFF\" />\n          <ThemedText style={styles.saveButtonText}>\n            {isLoading ? \"Adding...\" : \"Add Contact\"}\n          </ThemedText>\n        </Pressable>\n      </KeyboardAwareScrollViewCompat>\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  scrollContent: {\n    paddingHorizontal: Spacing.lg,\n  },\n  formCard: {\n    marginBottom: Spacing.lg,\n    padding: Spacing.lg,\n  },\n  inputContainer: {\n    marginBottom: Spacing.lg,\n  },\n  inputLabel: {\n    ...Typography.small,\n    fontWeight: \"500\",\n    marginBottom: Spacing.sm,\n  },\n  input: {\n    height: Spacing.inputHeight,\n    borderRadius: BorderRadius.sm,\n    paddingHorizontal: Spacing.md,\n    borderWidth: 1,\n    ...Typography.body,\n  },\n  relationshipGrid: {\n    flexDirection: \"row\",\n    flexWrap: \"wrap\",\n    gap: Spacing.sm,\n  },\n  relationshipButton: {\n    paddingVertical: Spacing.sm,\n    paddingHorizontal: Spacing.md,\n    borderRadius: BorderRadius.sm,\n  },\n  relationshipText: {\n    ...Typography.small,\n    fontWeight: \"500\",\n  },\n  primaryCard: {\n    marginBottom: Spacing.lg,\n    padding: Spacing.lg,\n  },\n  primaryRow: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  primaryInfo: {\n    flex: 1,\n    marginRight: Spacing.md,\n  },\n  primaryTitle: {\n    ...Typography.body,\n    fontWeight: \"600\",\n  },\n  primarySubtitle: {\n    ...Typography.small,\n    marginTop: Spacing.xs,\n  },\n  infoBox: {\n    flexDirection: \"row\",\n    alignItems: \"flex-start\",\n    gap: Spacing.sm,\n    marginBottom: Spacing[\"2xl\"],\n    paddingHorizontal: Spacing.sm,\n  },\n  infoText: {\n    ...Typography.small,\n    flex: 1,\n    lineHeight: 20,\n  },\n  saveButton: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    height: Spacing.buttonHeight,\n    borderRadius: BorderRadius.md,\n    gap: Spacing.sm,\n  },\n  saveButtonText: {\n    color: \"#FFF\",\n    ...Typography.body,\n    fontWeight: \"600\",\n  },\n});\n","path":null,"size_bytes":9338,"size_tokens":null},"client/screens/HomeScreen.tsx":{"content":"import React, { useCallback, useState } from \"react\";\nimport {\n  View,\n  StyleSheet,\n  Pressable,\n  ScrollView,\n  Alert,\n  Platform,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useNavigation, useFocusEffect } from \"@react-navigation/native\";\nimport type { NativeStackNavigationProp } from \"@react-navigation/native-stack\";\nimport { useBottomTabBarHeight } from \"@react-navigation/bottom-tabs\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as Haptics from \"expo-haptics\";\nimport * as Location from \"expo-location\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { Card } from \"@/components/Card\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useUserStore } from \"@/stores/userStore\";\nimport { Spacing, BorderRadius, Typography } from \"@/constants/theme\";\nimport type { RootStackParamList } from \"@/navigation/RootStackNavigator\";\nimport SOSConfirmModal from \"@/components/SOSConfirmModal\";\n\nconst AVATARS = [\n  { icon: \"user\", color: \"#007AFF\" },\n  { icon: \"smile\", color: \"#34C759\" },\n  { icon: \"heart\", color: \"#FF2D55\" },\n  { icon: \"star\", color: \"#FF9500\" },\n  { icon: \"sun\", color: \"#FFCC00\" },\n  { icon: \"moon\", color: \"#5856D6\" },\n];\n\nexport default function HomeScreen() {\n  const insets = useSafeAreaInsets();\n  const tabBarHeight = useBottomTabBarHeight();\n  const navigation = useNavigation<NativeStackNavigationProp<RootStackParamList>>();\n  const { theme } = useTheme();\n  const { user, activeJourney, emergencyContacts, fetchActiveJourney, sendSOSAlert, hasLocationPermission, setLocationPermission } = useUserStore();\n\n  const [showSOSModal, setShowSOSModal] = useState(false);\n  const [isSendingSOS, setIsSendingSOS] = useState(false);\n\n  useFocusEffect(\n    useCallback(() => {\n      fetchActiveJourney();\n    }, [])\n  );\n\n  const handleSOSPress = async () => {\n    await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Heavy);\n    setShowSOSModal(true);\n  };\n\n  const handleConfirmSOS = async () => {\n    setIsSendingSOS(true);\n    try {\n      let latitude: string | undefined;\n      let longitude: string | undefined;\n\n      if (hasLocationPermission) {\n        try {\n          const location = await Location.getCurrentPositionAsync({\n            accuracy: Location.Accuracy.High,\n          });\n          latitude = location.coords.latitude.toString();\n          longitude = location.coords.longitude.toString();\n        } catch (e) {\n          console.error(\"Failed to get location:\", e);\n        }\n      }\n\n      const success = await sendSOSAlert(latitude, longitude);\n      if (success) {\n        Alert.alert(\n          \"SOS Sent\",\n          \"Emergency alert has been sent to your contacts. Stay safe!\",\n          [{ text: \"OK\" }]\n        );\n      } else {\n        Alert.alert(\"Error\", \"Failed to send SOS alert. Please try again or call emergency services directly.\");\n      }\n    } catch (error) {\n      Alert.alert(\"Error\", \"Something went wrong. Please call emergency services directly.\");\n    } finally {\n      setIsSendingSOS(false);\n      setShowSOSModal(false);\n    }\n  };\n\n  const handleStartJourney = async () => {\n    await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    \n    if (!hasLocationPermission) {\n      const { status } = await Location.requestForegroundPermissionsAsync();\n      if (status === \"granted\") {\n        setLocationPermission(true);\n      } else {\n        Alert.alert(\n          \"Location Required\",\n          \"Location access is needed for journey tracking. Please enable it in settings.\",\n          [\n            { text: \"Cancel\", style: \"cancel\" },\n          ]\n        );\n        return;\n      }\n    }\n\n    if (emergencyContacts.length === 0) {\n      Alert.alert(\n        \"No Emergency Contacts\",\n        \"Please add at least one emergency contact before starting a journey.\",\n        [\n          { text: \"Cancel\", style: \"cancel\" },\n          { text: \"Add Contact\", onPress: () => navigation.navigate(\"EmergencyContacts\") },\n        ]\n      );\n      return;\n    }\n\n    navigation.navigate(\"JourneySetup\");\n  };\n\n  const handleContinueJourney = () => {\n    navigation.navigate(\"ActiveJourney\");\n  };\n\n  const avatarInfo = AVATARS[user?.avatarIndex || 0];\n\n  return (\n    <ThemedView style={styles.container}>\n      <ScrollView\n        contentContainerStyle={[\n          styles.scrollContent,\n          { paddingTop: insets.top + Spacing[\"3xl\"], paddingBottom: tabBarHeight + Spacing.xl },\n        ]}\n        showsVerticalScrollIndicator={false}\n        scrollIndicatorInsets={{ bottom: insets.bottom }}\n      >\n        <View style={styles.header}>\n          <View style={[styles.avatarCircle, { backgroundColor: avatarInfo.color + \"20\" }]}>\n            <Feather name={avatarInfo.icon as any} size={24} color={avatarInfo.color} />\n          </View>\n          <View style={styles.headerText}>\n            <ThemedText style={styles.greeting}>Welcome back,</ThemedText>\n            <ThemedText style={styles.userName}>{user?.name || \"User\"}</ThemedText>\n          </View>\n          <Feather name=\"shield\" size={28} color={theme.primary} />\n        </View>\n\n        <Pressable\n          style={[styles.sosButton, { backgroundColor: theme.danger }]}\n          onPress={handleSOSPress}\n          onLongPress={handleSOSPress}\n        >\n          <View style={styles.sosInner}>\n            <Feather name=\"alert-circle\" size={48} color=\"#FFF\" />\n            <ThemedText style={styles.sosText}>SOS</ThemedText>\n            <ThemedText style={styles.sosSubtext}>Press & hold for emergency</ThemedText>\n          </View>\n        </Pressable>\n\n        {activeJourney ? (\n          <Card style={styles.journeyCard}>\n            <View style={styles.journeyHeader}>\n              <View style={[styles.journeyIcon, { backgroundColor: theme.primary + \"20\" }]}>\n                <Feather name=\"navigation\" size={24} color={theme.primary} />\n              </View>\n              <View style={styles.journeyInfo}>\n                <ThemedText style={styles.journeyTitle}>Active Journey</ThemedText>\n                <ThemedText style={[styles.journeyDestination, { color: theme.textSecondary }]}>\n                  To: {activeJourney.destination}\n                </ThemedText>\n              </View>\n            </View>\n            <Pressable\n              style={[styles.continueButton, { backgroundColor: theme.primary }]}\n              onPress={handleContinueJourney}\n            >\n              <ThemedText style={styles.continueButtonText}>View Journey</ThemedText>\n              <Feather name=\"arrow-right\" size={18} color=\"#FFF\" />\n            </Pressable>\n          </Card>\n        ) : (\n          <Card style={styles.journeyCard}>\n            <View style={styles.startJourneyContent}>\n              <View style={[styles.journeyIcon, { backgroundColor: theme.primary + \"20\" }]}>\n                <Feather name=\"map\" size={24} color={theme.primary} />\n              </View>\n              <View style={styles.startJourneyText}>\n                <ThemedText style={styles.journeyTitle}>Start a Journey</ThemedText>\n                <ThemedText style={[styles.journeySubtext, { color: theme.textSecondary }]}>\n                  Share your trip with trusted contacts\n                </ThemedText>\n              </View>\n            </View>\n            <Pressable\n              style={[styles.startButton, { backgroundColor: theme.primary }]}\n              onPress={handleStartJourney}\n            >\n              <Feather name=\"plus\" size={20} color=\"#FFF\" />\n              <ThemedText style={styles.startButtonText}>New Journey</ThemedText>\n            </Pressable>\n          </Card>\n        )}\n\n        <Card style={styles.quickActionsCard}>\n          <ThemedText style={styles.sectionTitle}>Quick Actions</ThemedText>\n          <View style={styles.quickActions}>\n            <Pressable\n              style={[styles.quickActionButton, { backgroundColor: theme.backgroundSecondary }]}\n              onPress={() => navigation.navigate(\"EmergencyContacts\")}\n            >\n              <View style={[styles.quickActionIcon, { backgroundColor: theme.danger + \"20\" }]}>\n                <Feather name=\"users\" size={20} color={theme.danger} />\n              </View>\n              <ThemedText style={styles.quickActionText}>Contacts</ThemedText>\n            </Pressable>\n\n            <Pressable\n              style={[styles.quickActionButton, { backgroundColor: theme.backgroundSecondary }]}\n              onPress={() => navigation.navigate(\"EditProfile\")}\n            >\n              <View style={[styles.quickActionIcon, { backgroundColor: theme.primary + \"20\" }]}>\n                <Feather name=\"user\" size={20} color={theme.primary} />\n              </View>\n              <ThemedText style={styles.quickActionText}>Profile</ThemedText>\n            </Pressable>\n          </View>\n        </Card>\n\n        <Card style={styles.infoCard}>\n          <View style={styles.infoHeader}>\n            <Feather name=\"info\" size={20} color={theme.primary} />\n            <ThemedText style={styles.infoTitle}>Safety Tips</ThemedText>\n          </View>\n          <ThemedText style={[styles.infoText, { color: theme.textSecondary }]}>\n            Always share your journey with trusted contacts and keep your phone charged when traveling alone.\n          </ThemedText>\n        </Card>\n      </ScrollView>\n\n      <SOSConfirmModal\n        visible={showSOSModal}\n        onConfirm={handleConfirmSOS}\n        onCancel={() => setShowSOSModal(false)}\n        isLoading={isSendingSOS}\n      />\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  scrollContent: {\n    paddingHorizontal: Spacing.lg,\n  },\n  header: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    marginBottom: Spacing[\"2xl\"],\n  },\n  avatarCircle: {\n    width: 48,\n    height: 48,\n    borderRadius: 24,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  headerText: {\n    flex: 1,\n    marginLeft: Spacing.md,\n  },\n  greeting: {\n    ...Typography.small,\n    opacity: 0.7,\n  },\n  userName: {\n    ...Typography.h4,\n  },\n  sosButton: {\n    height: 180,\n    borderRadius: BorderRadius[\"2xl\"],\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    marginBottom: Spacing.xl,\n    shadowColor: \"#DC3545\",\n    shadowOffset: { width: 0, height: 8 },\n    shadowOpacity: 0.3,\n    shadowRadius: 16,\n    elevation: 8,\n  },\n  sosInner: {\n    alignItems: \"center\",\n  },\n  sosText: {\n    color: \"#FFF\",\n    ...Typography.h1,\n    marginTop: Spacing.sm,\n  },\n  sosSubtext: {\n    color: \"rgba(255,255,255,0.8)\",\n    ...Typography.small,\n    marginTop: Spacing.xs,\n  },\n  journeyCard: {\n    marginBottom: Spacing.lg,\n    padding: Spacing.lg,\n  },\n  journeyHeader: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    marginBottom: Spacing.lg,\n  },\n  journeyIcon: {\n    width: 48,\n    height: 48,\n    borderRadius: 24,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  journeyInfo: {\n    flex: 1,\n    marginLeft: Spacing.md,\n  },\n  journeyTitle: {\n    ...Typography.h4,\n  },\n  journeyDestination: {\n    ...Typography.small,\n  },\n  journeySubtext: {\n    ...Typography.small,\n  },\n  continueButton: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    height: 44,\n    borderRadius: BorderRadius.sm,\n    gap: Spacing.sm,\n  },\n  continueButtonText: {\n    color: \"#FFF\",\n    ...Typography.body,\n    fontWeight: \"600\",\n  },\n  startJourneyContent: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    marginBottom: Spacing.lg,\n  },\n  startJourneyText: {\n    flex: 1,\n    marginLeft: Spacing.md,\n  },\n  startButton: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    height: 44,\n    borderRadius: BorderRadius.sm,\n    gap: Spacing.sm,\n  },\n  startButtonText: {\n    color: \"#FFF\",\n    ...Typography.body,\n    fontWeight: \"600\",\n  },\n  quickActionsCard: {\n    marginBottom: Spacing.lg,\n    padding: Spacing.lg,\n  },\n  sectionTitle: {\n    ...Typography.h4,\n    marginBottom: Spacing.md,\n  },\n  quickActions: {\n    flexDirection: \"row\",\n    gap: Spacing.md,\n  },\n  quickActionButton: {\n    flex: 1,\n    alignItems: \"center\",\n    paddingVertical: Spacing.lg,\n    borderRadius: BorderRadius.sm,\n  },\n  quickActionIcon: {\n    width: 44,\n    height: 44,\n    borderRadius: 22,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    marginBottom: Spacing.sm,\n  },\n  quickActionText: {\n    ...Typography.small,\n    fontWeight: \"500\",\n  },\n  infoCard: {\n    marginBottom: Spacing.lg,\n    padding: Spacing.lg,\n  },\n  infoHeader: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.sm,\n    marginBottom: Spacing.sm,\n  },\n  infoTitle: {\n    ...Typography.body,\n    fontWeight: \"600\",\n  },\n  infoText: {\n    ...Typography.small,\n    lineHeight: 20,\n  },\n});\n","path":null,"size_bytes":12828,"size_tokens":null},"client/components/ThemedText.tsx":{"content":"import { Text, type TextProps } from \"react-native\";\n\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Typography } from \"@/constants/theme\";\n\nexport type ThemedTextProps = TextProps & {\n  lightColor?: string;\n  darkColor?: string;\n  type?: \"h1\" | \"h2\" | \"h3\" | \"h4\" | \"body\" | \"small\" | \"link\";\n};\n\nexport function ThemedText({\n  style,\n  lightColor,\n  darkColor,\n  type = \"body\",\n  ...rest\n}: ThemedTextProps) {\n  const { theme, isDark } = useTheme();\n\n  const getColor = () => {\n    if (isDark && darkColor) {\n      return darkColor;\n    }\n\n    if (!isDark && lightColor) {\n      return lightColor;\n    }\n\n    if (type === \"link\") {\n      return theme.link;\n    }\n\n    return theme.text;\n  };\n\n  const getTypeStyle = () => {\n    switch (type) {\n      case \"h1\":\n        return Typography.h1;\n      case \"h2\":\n        return Typography.h2;\n      case \"h3\":\n        return Typography.h3;\n      case \"h4\":\n        return Typography.h4;\n      case \"body\":\n        return Typography.body;\n      case \"small\":\n        return Typography.small;\n      case \"link\":\n        return Typography.link;\n      default:\n        return Typography.body;\n    }\n  };\n\n  return (\n    <Text style={[{ color: getColor() }, getTypeStyle(), style]} {...rest} />\n  );\n}\n","path":null,"size_bytes":1251,"size_tokens":null},"client/App.tsx":{"content":"import React from \"react\";\nimport { StyleSheet } from \"react-native\";\nimport { NavigationContainer } from \"@react-navigation/native\";\nimport { GestureHandlerRootView } from \"react-native-gesture-handler\";\nimport { KeyboardProvider } from \"react-native-keyboard-controller\";\nimport { SafeAreaProvider } from \"react-native-safe-area-context\";\nimport { StatusBar } from \"expo-status-bar\";\n\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { queryClient } from \"@/lib/query-client\";\n\nimport RootStackNavigator from \"@/navigation/RootStackNavigator\";\nimport { ErrorBoundary } from \"@/components/ErrorBoundary\";\n\nexport default function App() {\n  return (\n    <ErrorBoundary>\n      <QueryClientProvider client={queryClient}>\n        <SafeAreaProvider>\n          <GestureHandlerRootView style={styles.root}>\n            <KeyboardProvider>\n              <NavigationContainer>\n                <RootStackNavigator />\n              </NavigationContainer>\n              <StatusBar style=\"auto\" />\n            </KeyboardProvider>\n          </GestureHandlerRootView>\n        </SafeAreaProvider>\n      </QueryClientProvider>\n    </ErrorBoundary>\n  );\n}\n\nconst styles = StyleSheet.create({\n  root: {\n    flex: 1,\n  },\n});\n","path":null,"size_bytes":1225,"size_tokens":null},"client/hooks/useColorScheme.ts":{"content":"export { useColorScheme } from \"react-native\";\n","path":null,"size_bytes":47,"size_tokens":null},"client/constants/theme.ts":{"content":"import { Platform } from \"react-native\";\n\nconst tintColorLight = \"#007AFF\";\nconst tintColorDark = \"#0A84FF\";\n\nexport const Colors = {\n  light: {\n    text: \"#11181C\",\n    textSecondary: \"#687076\",\n    buttonText: \"#FFFFFF\",\n    tabIconDefault: \"#687076\",\n    tabIconSelected: tintColorLight,\n    link: \"#007AFF\",\n    backgroundRoot: \"#FFFFFF\",\n    backgroundDefault: \"#F2F2F2\",\n    backgroundSecondary: \"#E6E6E6\",\n    backgroundTertiary: \"#D9D9D9\",\n    primary: \"#007AFF\",\n    danger: \"#DC3545\",\n    dangerLight: \"#FEE2E5\",\n    success: \"#28A745\",\n    successLight: \"#D4EDDA\",\n    warning: \"#FFC107\",\n    warningLight: \"#FFF3CD\",\n    border: \"#E6E6E6\",\n    cardBackground: \"#FFFFFF\",\n  },\n  dark: {\n    text: \"#ECEDEE\",\n    textSecondary: \"#9BA1A6\",\n    buttonText: \"#FFFFFF\",\n    tabIconDefault: \"#9BA1A6\",\n    tabIconSelected: tintColorDark,\n    link: \"#0A84FF\",\n    backgroundRoot: \"#1F2123\",\n    backgroundDefault: \"#2A2C2E\",\n    backgroundSecondary: \"#353739\",\n    backgroundTertiary: \"#404244\",\n    primary: \"#0A84FF\",\n    danger: \"#FF4757\",\n    dangerLight: \"#3D2A2A\",\n    success: \"#4CD137\",\n    successLight: \"#2A3D2A\",\n    warning: \"#FFC107\",\n    warningLight: \"#3D3A2A\",\n    border: \"#404244\",\n    cardBackground: \"#2A2C2E\",\n  },\n};\n\nexport const Spacing = {\n  xs: 4,\n  sm: 8,\n  md: 12,\n  lg: 16,\n  xl: 20,\n  \"2xl\": 24,\n  \"3xl\": 32,\n  \"4xl\": 40,\n  \"5xl\": 48,\n  inputHeight: 48,\n  buttonHeight: 52,\n};\n\nexport const BorderRadius = {\n  xs: 8,\n  sm: 12,\n  md: 18,\n  lg: 24,\n  xl: 30,\n  \"2xl\": 40,\n  \"3xl\": 50,\n  full: 9999,\n};\n\nexport const Typography = {\n  h1: {\n    fontSize: 32,\n    lineHeight: 40,\n    fontWeight: \"700\" as const,\n  },\n  h2: {\n    fontSize: 28,\n    lineHeight: 36,\n    fontWeight: \"700\" as const,\n  },\n  h3: {\n    fontSize: 24,\n    lineHeight: 32,\n    fontWeight: \"600\" as const,\n  },\n  h4: {\n    fontSize: 20,\n    lineHeight: 28,\n    fontWeight: \"600\" as const,\n  },\n  body: {\n    fontSize: 16,\n    lineHeight: 24,\n    fontWeight: \"400\" as const,\n  },\n  small: {\n    fontSize: 14,\n    lineHeight: 20,\n    fontWeight: \"400\" as const,\n  },\n  link: {\n    fontSize: 16,\n    lineHeight: 24,\n    fontWeight: \"400\" as const,\n  },\n};\n\nexport const Fonts = Platform.select({\n  ios: {\n    sans: \"system-ui\",\n    serif: \"ui-serif\",\n    rounded: \"ui-rounded\",\n    mono: \"ui-monospace\",\n  },\n  default: {\n    sans: \"normal\",\n    serif: \"serif\",\n    rounded: \"normal\",\n    mono: \"monospace\",\n  },\n  web: {\n    sans: \"system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif\",\n    serif: \"Georgia, 'Times New Roman', serif\",\n    rounded:\n      \"'SF Pro Rounded', 'Hiragino Maru Gothic ProN', Meiryo, 'MS PGothic', sans-serif\",\n    mono: \"SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace\",\n  },\n});\n","path":null,"size_bytes":2785,"size_tokens":null},"client/screens/EditProfileScreen.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport {\n  View,\n  TextInput,\n  StyleSheet,\n  Pressable,\n  Alert,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useHeaderHeight } from \"@react-navigation/elements\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as Haptics from \"expo-haptics\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { KeyboardAwareScrollViewCompat } from \"@/components/KeyboardAwareScrollViewCompat\";\nimport { Card } from \"@/components/Card\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useUserStore } from \"@/stores/userStore\";\nimport { Spacing, BorderRadius, Typography } from \"@/constants/theme\";\n\nconst AVATARS = [\n  { icon: \"user\", color: \"#007AFF\" },\n  { icon: \"smile\", color: \"#34C759\" },\n  { icon: \"heart\", color: \"#FF2D55\" },\n  { icon: \"star\", color: \"#FF9500\" },\n  { icon: \"sun\", color: \"#FFCC00\" },\n  { icon: \"moon\", color: \"#5856D6\" },\n];\n\nexport default function EditProfileScreen() {\n  const insets = useSafeAreaInsets();\n  const headerHeight = useHeaderHeight();\n  const navigation = useNavigation();\n  const { theme } = useTheme();\n  const { user, updateUser } = useUserStore();\n\n  const [name, setName] = useState(user?.name || \"\");\n  const [selectedAvatar, setSelectedAvatar] = useState(user?.avatarIndex || 0);\n  const [height, setHeight] = useState(user?.height || \"\");\n  const [weight, setWeight] = useState(user?.weight || \"\");\n  const [skinTone, setSkinTone] = useState(user?.skinTone || \"\");\n  const [eyeColor, setEyeColor] = useState(user?.eyeColor || \"\");\n  const [distinguishingFeatures, setDistinguishingFeatures] = useState(user?.distinguishingFeatures || \"\");\n  const [medicalInfo, setMedicalInfo] = useState(user?.medicalInfo || \"\");\n  const [codeWord, setCodeWord] = useState(user?.codeWord || \"\");\n  const [isLoading, setIsLoading] = useState(false);\n\n  useEffect(() => {\n    if (user) {\n      setName(user.name || \"\");\n      setSelectedAvatar(user.avatarIndex || 0);\n      setHeight(user.height || \"\");\n      setWeight(user.weight || \"\");\n      setSkinTone(user.skinTone || \"\");\n      setEyeColor(user.eyeColor || \"\");\n      setDistinguishingFeatures(user.distinguishingFeatures || \"\");\n      setMedicalInfo(user.medicalInfo || \"\");\n      setCodeWord(user.codeWord || \"\");\n    }\n  }, [user]);\n\n  const handleSave = async () => {\n    if (!name.trim()) {\n      Alert.alert(\"Name Required\", \"Please enter your name.\");\n      return;\n    }\n\n    await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n    setIsLoading(true);\n\n    try {\n      await updateUser({\n        name: name.trim(),\n        avatarIndex: selectedAvatar,\n        height: height.trim() || null,\n        weight: weight.trim() || null,\n        skinTone: skinTone.trim() || null,\n        eyeColor: eyeColor.trim() || null,\n        distinguishingFeatures: distinguishingFeatures.trim() || null,\n        medicalInfo: medicalInfo.trim() || null,\n        codeWord: codeWord.trim() || null,\n      });\n      Alert.alert(\"Success\", \"Profile updated successfully!\");\n      navigation.goBack();\n    } catch (error) {\n      Alert.alert(\"Error\", \"Failed to update profile. Please try again.\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const renderInput = (\n    label: string,\n    value: string,\n    onChangeText: (text: string) => void,\n    placeholder: string,\n    multiline = false\n  ) => (\n    <View style={styles.inputContainer}>\n      <ThemedText style={[styles.inputLabel, { color: theme.textSecondary }]}>\n        {label}\n      </ThemedText>\n      <TextInput\n        style={[\n          styles.input,\n          {\n            backgroundColor: theme.backgroundSecondary,\n            color: theme.text,\n            borderColor: theme.border,\n          },\n          multiline && styles.multilineInput,\n        ]}\n        placeholder={placeholder}\n        placeholderTextColor={theme.textSecondary}\n        value={value}\n        onChangeText={onChangeText}\n        multiline={multiline}\n        numberOfLines={multiline ? 3 : 1}\n      />\n    </View>\n  );\n\n  return (\n    <ThemedView style={styles.container}>\n      <KeyboardAwareScrollViewCompat\n        style={{ flex: 1 }}\n        contentContainerStyle={[\n          styles.scrollContent,\n          { paddingTop: headerHeight + Spacing.xl, paddingBottom: insets.bottom + Spacing[\"2xl\"] },\n        ]}\n        scrollIndicatorInsets={{ bottom: insets.bottom }}\n      >\n        <Card style={styles.avatarCard}>\n          <ThemedText style={styles.sectionTitle}>Choose Your Avatar</ThemedText>\n          <View style={styles.avatarContainer}>\n            {AVATARS.map((avatar, index) => (\n              <Pressable\n                key={index}\n                onPress={() => {\n                  setSelectedAvatar(index);\n                  Haptics.selectionAsync();\n                }}\n                style={[\n                  styles.avatarButton,\n                  { backgroundColor: avatar.color + \"20\" },\n                  selectedAvatar === index && { borderColor: avatar.color, borderWidth: 3 },\n                ]}\n              >\n                <Feather name={avatar.icon as any} size={28} color={avatar.color} />\n              </Pressable>\n            ))}\n          </View>\n        </Card>\n\n        <Card style={styles.infoCard}>\n          <ThemedText style={styles.sectionTitle}>Basic Information</ThemedText>\n          {renderInput(\"Name *\", name, setName, \"Your name\")}\n          {renderInput(\"Code Word\", codeWord, setCodeWord, \"Secret word to verify identity\")}\n        </Card>\n\n        <Card style={styles.infoCard}>\n          <View style={styles.sectionHeader}>\n            <ThemedText style={styles.sectionTitle}>Physical Description</ThemedText>\n            <ThemedText style={[styles.sectionSubtitle, { color: theme.textSecondary }]}>\n              Helps identify you in emergencies\n            </ThemedText>\n          </View>\n\n          <View style={styles.rowInputs}>\n            <View style={[styles.inputContainer, { flex: 1 }]}>\n              <ThemedText style={[styles.inputLabel, { color: theme.textSecondary }]}>\n                Height\n              </ThemedText>\n              <TextInput\n                style={[\n                  styles.input,\n                  {\n                    backgroundColor: theme.backgroundSecondary,\n                    color: theme.text,\n                    borderColor: theme.border,\n                  },\n                ]}\n                placeholder={'e.g., 5\\'8\"'}\n                placeholderTextColor={theme.textSecondary}\n                value={height}\n                onChangeText={setHeight}\n              />\n            </View>\n            <View style={[styles.inputContainer, { flex: 1 }]}>\n              <ThemedText style={[styles.inputLabel, { color: theme.textSecondary }]}>\n                Weight\n              </ThemedText>\n              <TextInput\n                style={[\n                  styles.input,\n                  {\n                    backgroundColor: theme.backgroundSecondary,\n                    color: theme.text,\n                    borderColor: theme.border,\n                  },\n                ]}\n                placeholder=\"e.g., 150 lbs\"\n                placeholderTextColor={theme.textSecondary}\n                value={weight}\n                onChangeText={setWeight}\n              />\n            </View>\n          </View>\n\n          <View style={styles.rowInputs}>\n            <View style={[styles.inputContainer, { flex: 1 }]}>\n              <ThemedText style={[styles.inputLabel, { color: theme.textSecondary }]}>\n                Skin Tone\n              </ThemedText>\n              <TextInput\n                style={[\n                  styles.input,\n                  {\n                    backgroundColor: theme.backgroundSecondary,\n                    color: theme.text,\n                    borderColor: theme.border,\n                  },\n                ]}\n                placeholder=\"e.g., Fair\"\n                placeholderTextColor={theme.textSecondary}\n                value={skinTone}\n                onChangeText={setSkinTone}\n              />\n            </View>\n            <View style={[styles.inputContainer, { flex: 1 }]}>\n              <ThemedText style={[styles.inputLabel, { color: theme.textSecondary }]}>\n                Eye Color\n              </ThemedText>\n              <TextInput\n                style={[\n                  styles.input,\n                  {\n                    backgroundColor: theme.backgroundSecondary,\n                    color: theme.text,\n                    borderColor: theme.border,\n                  },\n                ]}\n                placeholder=\"e.g., Brown\"\n                placeholderTextColor={theme.textSecondary}\n                value={eyeColor}\n                onChangeText={setEyeColor}\n              />\n            </View>\n          </View>\n\n          {renderInput(\n            \"Distinguishing Features\",\n            distinguishingFeatures,\n            setDistinguishingFeatures,\n            \"e.g., Tattoo on left arm, scar on chin\",\n            true\n          )}\n        </Card>\n\n        <Card style={styles.infoCard}>\n          <ThemedText style={styles.sectionTitle}>Medical Information</ThemedText>\n          {renderInput(\n            \"Medical Conditions / Allergies\",\n            medicalInfo,\n            setMedicalInfo,\n            \"Important medical information\",\n            true\n          )}\n        </Card>\n\n        <Pressable\n          style={[\n            styles.saveButton,\n            { backgroundColor: theme.primary },\n            isLoading && { opacity: 0.6 },\n          ]}\n          onPress={handleSave}\n          disabled={isLoading}\n        >\n          <Feather name=\"check\" size={20} color=\"#FFF\" />\n          <ThemedText style={styles.saveButtonText}>\n            {isLoading ? \"Saving...\" : \"Save Changes\"}\n          </ThemedText>\n        </Pressable>\n      </KeyboardAwareScrollViewCompat>\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  scrollContent: {\n    paddingHorizontal: Spacing.lg,\n  },\n  avatarCard: {\n    marginBottom: Spacing.lg,\n    padding: Spacing.lg,\n  },\n  sectionTitle: {\n    ...Typography.body,\n    fontWeight: \"600\",\n    marginBottom: Spacing.md,\n  },\n  sectionHeader: {\n    marginBottom: Spacing.md,\n  },\n  sectionSubtitle: {\n    ...Typography.small,\n    marginTop: Spacing.xs,\n  },\n  avatarContainer: {\n    flexDirection: \"row\",\n    flexWrap: \"wrap\",\n    gap: Spacing.md,\n  },\n  avatarButton: {\n    width: 56,\n    height: 56,\n    borderRadius: 28,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    borderWidth: 2,\n    borderColor: \"transparent\",\n  },\n  infoCard: {\n    marginBottom: Spacing.lg,\n    padding: Spacing.lg,\n  },\n  inputContainer: {\n    marginBottom: Spacing.md,\n  },\n  inputLabel: {\n    ...Typography.small,\n    marginBottom: Spacing.xs,\n  },\n  input: {\n    height: Spacing.inputHeight,\n    borderRadius: BorderRadius.sm,\n    paddingHorizontal: Spacing.md,\n    borderWidth: 1,\n    ...Typography.body,\n  },\n  multilineInput: {\n    height: 80,\n    textAlignVertical: \"top\",\n    paddingTop: Spacing.md,\n  },\n  rowInputs: {\n    flexDirection: \"row\",\n    gap: Spacing.md,\n  },\n  saveButton: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    height: Spacing.buttonHeight,\n    borderRadius: BorderRadius.md,\n    gap: Spacing.sm,\n  },\n  saveButtonText: {\n    color: \"#FFF\",\n    ...Typography.body,\n    fontWeight: \"600\",\n  },\n});\n","path":null,"size_bytes":11611,"size_tokens":null},"server/vonage.ts":{"content":"import { Vonage } from \"@vonage/server-sdk\";\n\nconst vonage = new Vonage({\n  apiKey: process.env.VONAGE_API_KEY || \"\",\n  apiSecret: process.env.VONAGE_API_SECRET || \"\",\n});\n\nconst VONAGE_FROM = \"SafeConnect\";\n\nexport interface SMSResult {\n  success: boolean;\n  messageId?: string;\n  error?: string;\n}\n\nexport async function sendSMS(to: string, text: string): Promise<SMSResult> {\n  try {\n    const cleanPhone = to.replace(/[^\\d+]/g, \"\");\n    \n    const response = await vonage.sms.send({\n      to: cleanPhone,\n      from: VONAGE_FROM,\n      text: text,\n    });\n\n    const message = response.messages[0];\n    if (message.status === \"0\") {\n      console.log(`SMS sent successfully to ${cleanPhone}, messageId: ${(message as any)[\"message-id\"]}`);\n      return { success: true, messageId: (message as any)[\"message-id\"] };\n    } else {\n      console.error(`SMS failed to ${cleanPhone}:`, (message as any).errorText || (message as any)[\"error-text\"]);\n      return { success: false, error: (message as any).errorText || (message as any)[\"error-text\"] };\n    }\n  } catch (error: any) {\n    console.error(\"Vonage SMS error:\", error);\n    return { success: false, error: error.message || \"Unknown error\" };\n  }\n}\n\nexport async function sendSOSAlertSMS(\n  contactPhone: string,\n  contactName: string,\n  userName: string,\n  latitude?: string,\n  longitude?: string\n): Promise<SMSResult> {\n  let message = `EMERGENCY ALERT from SafeConnect!\\n\\n${userName} has triggered an SOS emergency alert.`;\n  \n  if (latitude && longitude) {\n    const mapsUrl = `https://maps.google.com/maps?q=${latitude},${longitude}`;\n    message += `\\n\\nCurrent Location:\\n${mapsUrl}`;\n  }\n  \n  message += `\\n\\nPlease try to contact ${userName} immediately or call emergency services if needed.`;\n  \n  return sendSMS(contactPhone, message);\n}\n\nexport async function sendJourneyStartSMS(\n  contactPhone: string,\n  contactName: string,\n  userName: string,\n  startLocation: string,\n  destination: string,\n  estimatedDuration: number,\n  expectedArrivalTime: Date\n): Promise<SMSResult> {\n  const arrivalTimeStr = expectedArrivalTime.toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    hour12: true,\n  });\n  \n  const message = `SafeConnect Journey Alert\\n\\n${userName} has started a journey:\\n\\nFrom: ${startLocation}\\nTo: ${destination}\\n\\nExpected Duration: ${estimatedDuration} minutes\\nExpected Arrival: ${arrivalTimeStr}\\n\\nYou'll be notified if they don't arrive safely.`;\n  \n  return sendSMS(contactPhone, message);\n}\n\nexport async function sendJourneyCompletedSMS(\n  contactPhone: string,\n  contactName: string,\n  userName: string,\n  destination: string\n): Promise<SMSResult> {\n  const message = `SafeConnect Update\\n\\n${userName} has arrived safely at ${destination}. No action needed.`;\n  \n  return sendSMS(contactPhone, message);\n}\n\nexport async function sendJourneyOverdueSMS(\n  contactPhone: string,\n  contactName: string,\n  userName: string,\n  destination: string,\n  startLocation: string,\n  lastLatitude?: string,\n  lastLongitude?: string\n): Promise<SMSResult> {\n  let message = `ATTENTION: SafeConnect Alert\\n\\n${userName} has not arrived at their destination.\\n\\nRoute: ${startLocation} to ${destination}`;\n  \n  if (lastLatitude && lastLongitude) {\n    const mapsUrl = `https://maps.google.com/maps?q=${lastLatitude},${lastLongitude}`;\n    message += `\\n\\nLast Known Location:\\n${mapsUrl}`;\n  }\n  \n  message += `\\n\\nPlease try to contact ${userName} to ensure they are safe.`;\n  \n  return sendSMS(contactPhone, message);\n}\n\nconst otpStore = new Map<string, { code: string; expires: number; attempts: number }>();\n\nexport function generateOTP(): string {\n  return Math.floor(100000 + Math.random() * 900000).toString();\n}\n\nexport async function sendOTP(phone: string): Promise<{ success: boolean; error?: string }> {\n  const code = generateOTP();\n  const expires = Date.now() + 10 * 60 * 1000;\n  \n  otpStore.set(phone, { code, expires, attempts: 0 });\n  \n  const message = `Your SafeConnect verification code is: ${code}\\n\\nThis code expires in 10 minutes.`;\n  \n  const result = await sendSMS(phone, message);\n  \n  if (!result.success) {\n    otpStore.delete(phone);\n  }\n  \n  return { success: result.success, error: result.error };\n}\n\nexport function verifyOTP(phone: string, code: string): { valid: boolean; error?: string } {\n  const stored = otpStore.get(phone);\n  \n  if (!stored) {\n    return { valid: false, error: \"No verification code found. Please request a new code.\" };\n  }\n  \n  if (Date.now() > stored.expires) {\n    otpStore.delete(phone);\n    return { valid: false, error: \"Verification code has expired. Please request a new code.\" };\n  }\n  \n  if (stored.attempts >= 3) {\n    otpStore.delete(phone);\n    return { valid: false, error: \"Too many attempts. Please request a new code.\" };\n  }\n  \n  if (stored.code !== code) {\n    stored.attempts++;\n    return { valid: false, error: \"Invalid verification code. Please try again.\" };\n  }\n  \n  otpStore.delete(phone);\n  return { valid: true };\n}\n","path":null,"size_bytes":5003,"size_tokens":null},"scripts/build.js":{"content":"const fs = require(\"fs\");\nconst path = require(\"path\");\nconst { spawn } = require(\"child_process\");\nconst { Readable } = require(\"stream\");\nconst { pipeline } = require(\"stream/promises\");\n\nlet metroProcess = null;\n\nfunction exitWithError(message) {\n  console.error(message);\n  if (metroProcess) {\n    metroProcess.kill();\n  }\n  process.exit(1);\n}\n\nfunction setupSignalHandlers() {\n  const cleanup = () => {\n    if (metroProcess) {\n      console.log(\"Cleaning up Metro process...\");\n      metroProcess.kill();\n    }\n    process.exit(0);\n  };\n\n  process.on(\"SIGINT\", cleanup);\n  process.on(\"SIGTERM\", cleanup);\n  process.on(\"SIGHUP\", cleanup);\n}\n\nfunction getDeploymentUrl() {\n  if (process.env.REPLIT_INTERNAL_APP_DOMAIN) {\n    const url = `https://${process.env.REPLIT_INTERNAL_APP_DOMAIN}`;\n    console.log(\"Using REPLIT_INTERNAL_APP_DOMAIN:\", url);\n    return url;\n  }\n\n  if (process.env.REPLIT_DEV_DOMAIN) {\n    const url = `https://${process.env.REPLIT_DEV_DOMAIN}`;\n    console.log(\"Using REPLIT_DEV_DOMAIN:\", url);\n    return url;\n  }\n\n  console.error(\n    \"ERROR: REPLIT_INTERNAL_APP_DOMAIN and REPLIT_DEV_DOMAIN not set\",\n  );\n  process.exit(1);\n}\n\nfunction prepareDirectories(timestamp) {\n  console.log(\"Preparing build directories...\");\n\n  if (fs.existsSync(\"static-build\")) {\n    fs.rmSync(\"static-build\", { recursive: true });\n  }\n\n  const dirs = [\n    path.join(\"static-build\", timestamp, \"_expo\", \"static\", \"js\", \"ios\"),\n    path.join(\"static-build\", timestamp, \"_expo\", \"static\", \"js\", \"android\"),\n    path.join(\"static-build\", \"ios\"),\n    path.join(\"static-build\", \"android\"),\n  ];\n\n  for (const dir of dirs) {\n    fs.mkdirSync(dir, { recursive: true });\n  }\n\n  console.log(\"Build:\", timestamp);\n}\n\nfunction clearMetroCache() {\n  console.log(\"Clearing Metro cache...\");\n\n  const cacheDirs = [\n    ...fs.globSync(\".metro-cache\"),\n    ...fs.globSync(\"node_modules/.cache/metro\"),\n  ];\n\n  for (const dir of cacheDirs) {\n    fs.rmSync(dir, { recursive: true, force: true });\n  }\n\n  console.log(\"Cache cleared\");\n}\n\nasync function checkMetroHealth() {\n  try {\n    const response = await fetch(\"http://localhost:8081/status\", {\n      signal: AbortSignal.timeout(5000),\n    });\n    return response.ok;\n  } catch {\n    return false;\n  }\n}\n\nasync function startMetro() {\n  const isRunning = await checkMetroHealth();\n  if (isRunning) {\n    console.log(\"Metro already running\");\n    return;\n  }\n\n  console.log(\"Starting Metro...\");\n  metroProcess = spawn(\"npm\", [\"run\", \"expo:start:static:build\"], {\n    stdio: [\"ignore\", \"pipe\", \"pipe\"],\n    detached: false,\n  });\n\n  if (metroProcess.stdout) {\n    metroProcess.stdout.on(\"data\", (data) => {\n      const output = data.toString().trim();\n      if (output) console.log(`[Metro] ${output}`);\n    });\n  }\n  if (metroProcess.stderr) {\n    metroProcess.stderr.on(\"data\", (data) => {\n      const output = data.toString().trim();\n      if (output) console.error(`[Metro Error] ${output}`);\n    });\n  }\n\n  for (let i = 0; i < 60; i++) {\n    await new Promise((resolve) => setTimeout(resolve, 1000));\n\n    const healthy = await checkMetroHealth();\n    if (healthy) {\n      console.log(\"Metro ready\");\n      return;\n    }\n  }\n\n  console.error(\"Metro timeout\");\n  process.exit(1);\n}\n\nasync function downloadFile(url, outputPath) {\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), 120_000);\n\n  try {\n    console.log(`Downloading: ${url}`);\n    const response = await fetch(url, { signal: controller.signal });\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}`);\n    }\n\n    const file = fs.createWriteStream(outputPath);\n    await pipeline(Readable.fromWeb(response.body), file);\n\n    const fileSize = fs.statSync(outputPath).size;\n\n    if (fileSize === 0) {\n      fs.unlinkSync(outputPath);\n      throw new Error(\"Downloaded file is empty\");\n    }\n  } catch (error) {\n    if (fs.existsSync(outputPath)) {\n      fs.unlinkSync(outputPath);\n    }\n\n    if (error.name === \"AbortError\") {\n      throw new Error(`Download timeout after 2m: ${url}`);\n    }\n    throw error;\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n\nasync function downloadBundle(platform, timestamp) {\n  const url = new URL(\"http://localhost:8081/client/index.bundle\");\n  url.searchParams.set(\"platform\", platform);\n  url.searchParams.set(\"dev\", \"false\");\n  url.searchParams.set(\"hot\", \"false\");\n  url.searchParams.set(\"lazy\", \"false\");\n  url.searchParams.set(\"minify\", \"true\");\n\n  const output = path.join(\n    \"static-build\",\n    timestamp,\n    \"_expo\",\n    \"static\",\n    \"js\",\n    platform,\n    \"bundle.js\",\n  );\n\n  console.log(`Fetching ${platform} bundle...`);\n  await downloadFile(url.toString(), output);\n  console.log(`${platform} bundle ready`);\n}\n\nasync function downloadManifest(platform) {\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), 300_000);\n\n  try {\n    console.log(`Fetching ${platform} manifest...`);\n    const response = await fetch(\"http://localhost:8081/manifest\", {\n      headers: { \"expo-platform\": platform },\n      signal: controller.signal,\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}`);\n    }\n\n    const manifest = await response.json();\n    console.log(`${platform} manifest ready`);\n    return manifest;\n  } catch (error) {\n    if (error.name === \"AbortError\") {\n      throw new Error(\n        `Manifest download timeout after 5m for platform: ${platform}`,\n      );\n    }\n    throw error;\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n\nasync function downloadBundlesAndManifests(timestamp) {\n  console.log(\"Downloading bundles and manifests...\");\n  console.log(\"This may take several minutes for production builds...\");\n\n  try {\n    const results = await Promise.allSettled([\n      downloadBundle(\"ios\", timestamp),\n      downloadBundle(\"android\", timestamp),\n      downloadManifest(\"ios\"),\n      downloadManifest(\"android\"),\n    ]);\n\n    const failures = results\n      .map((result, index) => ({ result, index }))\n      .filter(({ result }) => result.status === \"rejected\");\n\n    if (failures.length > 0) {\n      const errorMessages = failures.map(({ result, index }) => {\n        const names = [\n          \"iOS bundle\",\n          \"Android bundle\",\n          \"iOS manifest\",\n          \"Android manifest\",\n        ];\n        return `  - ${names[index]}: ${result.reason?.message || result.reason}`;\n      });\n\n      exitWithError(`Download failed:\\n${errorMessages.join(\"\\n\")}`);\n    }\n\n    const iosManifest =\n      results[2].status === \"fulfilled\" ? results[2].value : null;\n    const androidManifest =\n      results[3].status === \"fulfilled\" ? results[3].value : null;\n\n    console.log(\"All downloads completed successfully\");\n    return { ios: iosManifest, android: androidManifest };\n  } catch (error) {\n    exitWithError(`Unexpected download error: ${error.message}`);\n  }\n}\n\nfunction extractAssets(timestamp) {\n  const bundles = {\n    ios: fs.readFileSync(\n      path.join(\n        \"static-build\",\n        timestamp,\n        \"_expo\",\n        \"static\",\n        \"js\",\n        \"ios\",\n        \"bundle.js\",\n      ),\n      \"utf-8\",\n    ),\n    android: fs.readFileSync(\n      path.join(\n        \"static-build\",\n        timestamp,\n        \"_expo\",\n        \"static\",\n        \"js\",\n        \"android\",\n        \"bundle.js\",\n      ),\n      \"utf-8\",\n    ),\n  };\n\n  const assetsMap = new Map();\n  const assetPattern =\n    /httpServerLocation:\"([^\"]+)\"[^}]*hash:\"([^\"]+)\"[^}]*name:\"([^\"]+)\"[^}]*type:\"([^\"]+)\"/g;\n\n  const extractFromBundle = (bundle, platform) => {\n    for (const match of bundle.matchAll(assetPattern)) {\n      const originalPath = match[1];\n      const filename = match[3] + \".\" + match[4];\n\n      const tempUrl = new URL(`http://localhost:8081${originalPath}`);\n      const unstablePath = tempUrl.searchParams.get(\"unstable_path\");\n\n      if (!unstablePath) {\n        throw new Error(`Asset missing unstable_path: ${originalPath}`);\n      }\n\n      const decodedPath = decodeURIComponent(unstablePath);\n      const key = path.posix.join(decodedPath, filename);\n\n      if (!assetsMap.has(key)) {\n        const asset = {\n          url: path.posix.join(\"/\", decodedPath, filename),\n          originalPath: originalPath,\n          filename: filename,\n          relativePath: decodedPath,\n          hash: match[2],\n          platforms: new Set(),\n        };\n\n        assetsMap.set(key, asset);\n      }\n      assetsMap.get(key).platforms.add(platform);\n    }\n  };\n\n  extractFromBundle(bundles.ios, \"ios\");\n  extractFromBundle(bundles.android, \"android\");\n\n  return Array.from(assetsMap.values());\n}\n\nasync function downloadAssets(assets, timestamp) {\n  if (assets.length === 0) {\n    return 0;\n  }\n\n  console.log(\"Downloading assets...\");\n  let successCount = 0;\n  const failures = [];\n\n  const downloadPromises = assets.map(async (asset) => {\n    const platform = Array.from(asset.platforms)[0];\n\n    const tempUrl = new URL(`http://localhost:8081${asset.originalPath}`);\n    const unstablePath = tempUrl.searchParams.get(\"unstable_path\");\n\n    if (!unstablePath) {\n      throw new Error(`Asset missing unstable_path: ${asset.originalPath}`);\n    }\n\n    const decodedPath = decodeURIComponent(unstablePath);\n    const metroUrl = new URL(\n      `http://localhost:8081${path.posix.join(\"/assets\", decodedPath, asset.filename)}`,\n    );\n    metroUrl.searchParams.set(\"platform\", platform);\n    metroUrl.searchParams.set(\"hash\", asset.hash);\n\n    const outputDir = path.join(\n      \"static-build\",\n      timestamp,\n      \"_expo\",\n      \"static\",\n      \"js\",\n      asset.relativePath,\n    );\n    fs.mkdirSync(outputDir, { recursive: true });\n    const output = path.join(outputDir, asset.filename);\n\n    try {\n      await downloadFile(metroUrl.toString(), output);\n      successCount++;\n    } catch (error) {\n      failures.push({\n        filename: asset.filename,\n        error: error.message,\n        url: metroUrl.toString(),\n      });\n    }\n  });\n\n  await Promise.all(downloadPromises);\n\n  if (failures.length > 0) {\n    const errorMsg =\n      `Failed to download ${failures.length} asset(s):\\n` +\n      failures\n        .map((f) => `  - ${f.filename}: ${f.error} (${f.url})`)\n        .join(\"\\n\");\n    exitWithError(errorMsg);\n  }\n\n  console.log(`Downloaded ${successCount} assets`);\n  return successCount;\n}\n\nfunction updateBundleUrls(timestamp, baseUrl) {\n  const updateForPlatform = (platform) => {\n    const bundlePath = path.join(\n      \"static-build\",\n      timestamp,\n      \"_expo\",\n      \"static\",\n      \"js\",\n      platform,\n      \"bundle.js\",\n    );\n    let bundle = fs.readFileSync(bundlePath, \"utf-8\");\n\n    bundle = bundle.replace(\n      /httpServerLocation:\"(\\/[^\"]+)\"/g,\n      (_match, capturedPath) => {\n        const tempUrl = new URL(`http://localhost:8081${capturedPath}`);\n        const unstablePath = tempUrl.searchParams.get(\"unstable_path\");\n\n        if (!unstablePath) {\n          throw new Error(\n            `Asset missing unstable_path in bundle: ${capturedPath}`,\n          );\n        }\n\n        const decodedPath = decodeURIComponent(unstablePath);\n        return `httpServerLocation:\"${baseUrl}/${timestamp}/_expo/static/js/${decodedPath}\"`;\n      },\n    );\n\n    fs.writeFileSync(bundlePath, bundle);\n  };\n\n  updateForPlatform(\"ios\");\n  updateForPlatform(\"android\");\n  console.log(\"Updated bundle URLs\");\n}\n\nfunction updateManifests(manifests, timestamp, baseUrl, assetsByHash) {\n  const updateForPlatform = (platform, manifest) => {\n    if (!manifest.launchAsset || !manifest.extra) {\n      exitWithError(`Malformed manifest for ${platform}`);\n    }\n\n    manifest.launchAsset.url = `${baseUrl}/${timestamp}/_expo/static/js/${platform}/bundle.js`;\n    manifest.launchAsset.key = `bundle-${timestamp}`;\n    manifest.createdAt = new Date(\n      Number(timestamp.split(\"-\")[0]),\n    ).toISOString();\n    manifest.extra.expoClient.hostUri =\n      baseUrl.replace(\"https://\", \"\") + \"/\" + platform;\n    manifest.extra.expoGo.debuggerHost =\n      baseUrl.replace(\"https://\", \"\") + \"/\" + platform;\n    manifest.extra.expoGo.packagerOpts.dev = false;\n\n    if (manifest.assets && manifest.assets.length > 0) {\n      manifest.assets.forEach((asset) => {\n        if (!asset.url) return;\n\n        const hash = asset.hash;\n        if (!hash) return;\n\n        const assetInfo = assetsByHash.get(hash);\n        if (!assetInfo) return;\n\n        asset.url = `${baseUrl}/${timestamp}/_expo/static/js/${assetInfo.relativePath}/${assetInfo.filename}`;\n      });\n    }\n\n    fs.writeFileSync(\n      path.join(\"static-build\", platform, \"manifest.json\"),\n      JSON.stringify(manifest, null, 2),\n    );\n  };\n\n  updateForPlatform(\"ios\", manifests.ios);\n  updateForPlatform(\"android\", manifests.android);\n  console.log(\"Manifests updated\");\n}\n\nasync function main() {\n  console.log(\"Building static Expo Go deployment...\");\n\n  setupSignalHandlers();\n\n  const baseUrl = getDeploymentUrl();\n  const timestamp = `${Date.now()}-${process.pid}`;\n\n  prepareDirectories(timestamp);\n  clearMetroCache();\n\n  await startMetro();\n\n  const downloadTimeout = 300000;\n  const downloadPromise = downloadBundlesAndManifests(timestamp);\n  const timeoutPromise = new Promise((_, reject) => {\n    setTimeout(() => {\n      reject(\n        new Error(\n          `Overall download timeout after ${downloadTimeout / 1000} seconds. ` +\n            \"Metro may be struggling to generate bundles. Check Metro logs above.\",\n        ),\n      );\n    }, downloadTimeout);\n  });\n\n  const manifests = await Promise.race([downloadPromise, timeoutPromise]);\n\n  console.log(\"Processing assets...\");\n  const assets = extractAssets(timestamp);\n  console.log(\"Found\", assets.length, \"unique asset(s)\");\n\n  const assetsByHash = new Map();\n  for (const asset of assets) {\n    assetsByHash.set(asset.hash, {\n      relativePath: asset.relativePath,\n      filename: asset.filename,\n    });\n  }\n\n  const assetCount = await downloadAssets(assets, timestamp);\n\n  if (assetCount > 0) {\n    updateBundleUrls(timestamp, baseUrl);\n  }\n\n  console.log(\"Updating manifests and creating landing page...\");\n  updateManifests(manifests, timestamp, baseUrl, assetsByHash);\n\n  console.log(\"Build complete! Deploy to:\", baseUrl);\n\n  if (metroProcess) {\n    metroProcess.kill();\n  }\n  process.exit(0);\n}\n\nmain().catch((error) => {\n  console.error(\"Build failed:\", error.message);\n  if (metroProcess) {\n    metroProcess.kill();\n  }\n  process.exit(1);\n});\n","path":null,"size_bytes":14413,"size_tokens":null},"design_guidelines.md":{"content":"# Design Guidelines: Safe Connect - Personal Safety App\n\n## Architecture Decisions\n\n### Authentication\n**Auth Required**: Yes\n- **Implementation**: Apple Sign-In for iOS, Google Sign-In for cross-platform\n- **Rationale**: Sensitive personal data and emergency contacts require secure storage and cross-device sync\n- **Auth Flow**: \n  - First-time users go through onboarding to set up profile and emergency contacts\n  - Returning users authenticate via SSO\n  - Account deletion requires double confirmation (Settings > Account > Delete)\n\n### Navigation Architecture\n**Root Navigation**: Tab Navigation (3 tabs)\n- **Home Tab**: Emergency access and journey status\n- **Journey Tab** (Center): Core action for starting/managing journeys  \n- **Profile Tab**: User details, emergency contacts, settings\n\n**Screen Stacks**:\n- Home Stack: Home  Journey History  Journey Details\n- Journey Stack: Journey Setup  Active Journey (modal)\n- Profile Stack: Profile  Edit Profile  Emergency Contacts  Settings\n\n## Screen Specifications\n\n### 1. Home Screen (Tab 1)\n- **Header**: Transparent, \"Safe Connect\" title, settings icon (right)\n- **Layout**: Scrollable, safe insets: top = headerHeight + Spacing.xl, bottom = tabBarHeight + Spacing.xl\n- **Components**:\n  - Large circular SOS button (most prominent element)\n  - Voice activation status card\n  - Active journey card (if in progress)\n  - Recent journey history (last 5)\n  - \"Start Journey\" quick action button\n\n### 2. Active Journey Screen (Modal)\n- **Header**: Custom transparent, \"Cancel Journey\" button (left)\n- **Layout**: Non-scrollable with map view, floating elements\n- **Safe Insets**: bottom = insets.bottom + 80, top = headerHeight + Spacing.xl\n- **Components**:\n  - Full-screen map with route and current location\n  - Floating journey info card (top): ETA, time remaining, distance\n  - Floating SOS button (bottom-right, circular with shadow)\n  - Voice activation indicator (top-left)\n- **Interaction**: SOS requires 1-second hold to prevent accidental triggers\n\n### 3. Journey Setup Screen (Tab 2)\n- **Header**: Default, \"New Journey\" title, \"Start\" button (right, disabled until valid)\n- **Layout**: Scrollable form\n- **Safe Insets**: top = Spacing.xl, bottom = tabBarHeight + Spacing.xl\n- **Components**:\n  - Starting point (auto-filled with current location)\n  - Destination (search input)\n  - 3 route option cards with time estimates\n  - Emergency contact multi-select\n  - Expected delay slider (0-30 min)\n  - Optional journey note field\n\n### 4. Profile Screen (Tab 3)\n- **Header**: Transparent, \"Profile\" title, \"Edit\" button (right)\n- **Layout**: Scrollable\n- **Safe Insets**: top = headerHeight + Spacing.xl, bottom = tabBarHeight + Spacing.xl\n- **Components**:\n  - User avatar (tappable to change)\n  - Display name\n  - Personal safety details: height, weight, skin tone, eye color, distinguishing features\n  - Emergency contacts list\n  - Settings sections: Voice Activation, Notifications, Privacy, Account\n\n### 5. Edit Profile Screen\n- **Header**: Default, \"Edit Profile\", \"Cancel\" (left), \"Save\" (right)\n- **Layout**: Scrollable form\n- **Components**:\n  - Avatar picker grid\n  - Form fields: name, height, weight, skin tone dropdown, eye color dropdown\n  - Physical description text area\n  - Optional medical info\n\n### 6. Emergency Contacts Screen\n- **Header**: Default, \"Emergency Contacts\", \"Add\" button (right)\n- **Layout**: List view\n- **Components**:\n  - Contact cards with name, relationship, phone, primary toggle\n  - Empty state message\n  - Add/edit contact modal\n- **Requirements**: Minimum 1, maximum 5 contacts\n\n### 7. SOS Confirmation Modal\n- **Layout**: Center modal, high contrast\n- **Components**:\n  - Warning icon\n  - \"Send Emergency Alert?\" heading\n  - Explanation text\n  - \"Cancel\" and \"Send Alert\" (red, destructive) buttons\n  - Auto-trigger countdown (3-2-1) for voice activation\n- **Interaction**: Haptic feedback, cancelable anytime\n\n## Design System\n\n### Colors\n- **Primary**: #DC2626 (Red-600) - SOS, emergency actions\n- **Primary Light**: #FCA5A5 (Red-300) - Alert backgrounds\n- **Secondary**: #2563EB (Blue-600) - Journey actions\n- **Secondary Light**: #93C5FD (Blue-300) - Journey cards\n- **Success**: #16A34A (Green-600) - Safe status\n- **Warning**: #F59E0B (Amber-500) - Time warnings\n- **Background**: #FFFFFF / #F9FAFB (Gray-50)\n- **Text**: #111827 (Gray-900) / #6B7280 (Gray-500)\n- **Border**: #E5E7EB (Gray-200)\n\n### Typography\n- **Display**: System Bold, 32pt - Headlines\n- **Title Large**: System Semibold, 28pt - Screen titles\n- **Title**: System Semibold, 20pt - Section headers\n- **Body**: System Regular, 16pt - Default\n- **Caption**: System Regular, 14pt - Metadata\n- **Button**: System Semibold, 16pt - Buttons\n\n### Visual Design\n\n**SOS Button**:\n- 120pt circular diameter\n- Background: #DC2626\n- White \"SOS\" text, Title Large\n- Shadow: offset {width: 0, height: 2}, opacity 0.10, radius 2\n- Active: Scale 0.95\n- Hold-to-activate: Progress ring\n\n**Touchable Feedback**:\n- Standard buttons: Opacity 0.7\n- Cards: Scale 0.98\n- SOS: Heavy haptic feedback\n- Emergency actions: Haptic warning pattern\n\n**Form Inputs**:\n- Height: 48pt, border radius 8pt\n- Focus: 2pt border, secondary color\n- Error: 2pt border, primary color with message\n\n**Icons** (Feather from @expo/vector-icons):\n- Emergency: alert-circle\n- Journey: navigation, map-pin\n- Profile: user\n- Settings: settings\n- Location: map-pin\n- Contacts: users\n- Voice: mic\n\n### Critical Assets\n- 8 preset user avatars (simple geometric silhouettes)\n- App icon and splash screen with safety theme\n- Emergency alert icons","path":null,"size_bytes":5590,"size_tokens":null},"client/components/ThemedView.tsx":{"content":"import { View, type ViewProps } from \"react-native\";\n\nimport { useTheme } from \"@/hooks/useTheme\";\n\nexport type ThemedViewProps = ViewProps & {\n  lightColor?: string;\n  darkColor?: string;\n};\n\nexport function ThemedView({\n  style,\n  lightColor,\n  darkColor,\n  ...otherProps\n}: ThemedViewProps) {\n  const { theme, isDark } = useTheme();\n\n  const backgroundColor =\n    isDark && darkColor\n      ? darkColor\n      : !isDark && lightColor\n        ? lightColor\n        : theme.backgroundRoot;\n\n  return <View style={[{ backgroundColor }, style]} {...otherProps} />;\n}\n","path":null,"size_bytes":563,"size_tokens":null},"client/components/HeaderTitle.tsx":{"content":"import React from \"react\";\nimport { View, StyleSheet, Image } from \"react-native\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { Spacing } from \"@/constants/theme\";\n\ninterface HeaderTitleProps {\n  title: string;\n}\n\nexport function HeaderTitle({ title }: HeaderTitleProps) {\n  return (\n    <View style={styles.container}>\n      <Image\n        source={require(\"../../assets/images/icon.png\")}\n        style={styles.icon}\n        resizeMode=\"contain\"\n      />\n      <ThemedText style={styles.title}>{title}</ThemedText>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"flex-start\",\n  },\n  icon: {\n    width: 28,\n    height: 28,\n    marginRight: Spacing.sm,\n  },\n  title: {\n    fontSize: 17,\n    fontWeight: \"600\",\n  },\n});\n","path":null,"size_bytes":832,"size_tokens":null},"client/hooks/useTheme.ts":{"content":"import { Colors } from \"@/constants/theme\";\nimport { useColorScheme } from \"@/hooks/useColorScheme\";\n\nexport function useTheme() {\n  const colorScheme = useColorScheme();\n  const isDark = colorScheme === \"dark\";\n  const theme = Colors[colorScheme ?? \"light\"];\n\n  return {\n    theme,\n    isDark,\n  };\n}\n","path":null,"size_bytes":302,"size_tokens":null},"client/screens/OnboardingScreen.tsx":{"content":"import React, { useState, useRef } from \"react\";\nimport {\n  View,\n  TextInput,\n  StyleSheet,\n  Pressable,\n  Platform,\n  Linking,\n  Alert,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as Location from \"expo-location\";\nimport * as Haptics from \"expo-haptics\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { KeyboardAwareScrollViewCompat } from \"@/components/KeyboardAwareScrollViewCompat\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useUserStore } from \"@/stores/userStore\";\nimport { Spacing, BorderRadius, Typography } from \"@/constants/theme\";\n\nconst AVATARS = [\n  { icon: \"user\", color: \"#007AFF\" },\n  { icon: \"smile\", color: \"#34C759\" },\n  { icon: \"heart\", color: \"#FF2D55\" },\n  { icon: \"star\", color: \"#FF9500\" },\n  { icon: \"sun\", color: \"#FFCC00\" },\n  { icon: \"moon\", color: \"#5856D6\" },\n];\n\ntype OnboardingStep = \"welcome\" | \"phone\" | \"otp\" | \"permissions\" | \"contact\";\n\nexport default function OnboardingScreen() {\n  const insets = useSafeAreaInsets();\n  const { theme } = useTheme();\n  const { sendOTP, verifyOTP, createUserWithPhone, setLocationPermission, createEmergencyContact, setOnboarded } = useUserStore();\n\n  const [step, setStep] = useState<OnboardingStep>(\"welcome\");\n  const [phone, setPhone] = useState(\"\");\n  const [otpCode, setOtpCode] = useState(\"\");\n  const [selectedAvatar, setSelectedAvatar] = useState(0);\n  const [contactName, setContactName] = useState(\"\");\n  const [contactPhone, setContactPhone] = useState(\"\");\n  const [contactRelationship, setContactRelationship] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [otpSent, setOtpSent] = useState(false);\n  const [countdown, setCountdown] = useState(0);\n  const countdownRef = useRef<NodeJS.Timeout | null>(null);\n\n  const startCountdown = () => {\n    setCountdown(60);\n    if (countdownRef.current) clearInterval(countdownRef.current);\n    countdownRef.current = setInterval(() => {\n      setCountdown((prev) => {\n        if (prev <= 1) {\n          if (countdownRef.current) clearInterval(countdownRef.current);\n          return 0;\n        }\n        return prev - 1;\n      });\n    }, 1000);\n  };\n\n  const handleSendOTP = async () => {\n    if (!phone.trim() || phone.length < 10) {\n      Alert.alert(\"Invalid Phone\", \"Please enter a valid phone number with country code (e.g., +1234567890).\");\n      return;\n    }\n    \n    setIsLoading(true);\n    await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n    \n    try {\n      const result = await sendOTP(phone.trim());\n      if (result.success) {\n        setOtpSent(true);\n        startCountdown();\n        setStep(\"otp\");\n        Alert.alert(\"Code Sent\", \"A verification code has been sent to your phone.\");\n      } else {\n        Alert.alert(\"Error\", result.error || \"Failed to send verification code. Please try again.\");\n      }\n    } catch (error) {\n      Alert.alert(\"Error\", \"Failed to send verification code. Please try again.\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleVerifyOTP = async () => {\n    if (!otpCode.trim() || otpCode.length !== 6) {\n      Alert.alert(\"Invalid Code\", \"Please enter the 6-digit verification code.\");\n      return;\n    }\n    \n    setIsLoading(true);\n    await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n    \n    try {\n      const result = await verifyOTP(phone.trim(), otpCode.trim());\n      if (result.valid) {\n        await createUserWithPhone(phone.trim(), selectedAvatar);\n        setStep(\"permissions\");\n      } else {\n        Alert.alert(\"Verification Failed\", result.error || \"Invalid code. Please try again.\");\n      }\n    } catch (error) {\n      Alert.alert(\"Error\", \"Verification failed. Please try again.\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleResendOTP = async () => {\n    if (countdown > 0) return;\n    \n    setIsLoading(true);\n    try {\n      const result = await sendOTP(phone.trim());\n      if (result.success) {\n        startCountdown();\n        Alert.alert(\"Code Sent\", \"A new verification code has been sent to your phone.\");\n      } else {\n        Alert.alert(\"Error\", result.error || \"Failed to resend code.\");\n      }\n    } catch (error) {\n      Alert.alert(\"Error\", \"Failed to resend code.\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleNext = async () => {\n    await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n\n    if (step === \"welcome\") {\n      setStep(\"phone\");\n    } else if (step === \"permissions\") {\n      setStep(\"contact\");\n    } else if (step === \"contact\") {\n      if (contactName.trim() && contactPhone.trim()) {\n        setIsLoading(true);\n        try {\n          await createEmergencyContact({\n            name: contactName.trim(),\n            phone: contactPhone.trim(),\n            relationship: contactRelationship.trim() || \"Friend\",\n            isPrimary: true,\n            userId: \"\",\n          });\n        } catch (error) {\n          console.error(\"Failed to add contact:\", error);\n        }\n        setIsLoading(false);\n      }\n      setOnboarded(true);\n    }\n  };\n\n  const handleRequestLocation = async () => {\n    await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n    try {\n      const { status, canAskAgain } = await Location.requestForegroundPermissionsAsync();\n      if (status === \"granted\") {\n        setLocationPermission(true);\n        Alert.alert(\"Success\", \"Location access granted!\");\n      } else if (!canAskAgain && Platform.OS !== \"web\") {\n        Alert.alert(\n          \"Permission Required\",\n          \"Please enable location access in Settings to use journey tracking.\",\n          [\n            { text: \"Cancel\", style: \"cancel\" },\n            {\n              text: \"Open Settings\",\n              onPress: async () => {\n                try {\n                  await Linking.openSettings();\n                } catch {}\n              },\n            },\n          ]\n        );\n      }\n    } catch (error) {\n      console.error(\"Error requesting location:\", error);\n    }\n  };\n\n  const handleSkip = () => {\n    if (step === \"contact\") {\n      setOnboarded(true);\n    }\n  };\n\n  const renderWelcome = () => (\n    <View style={styles.stepContainer}>\n      <View style={[styles.iconCircle, { backgroundColor: theme.primary + \"20\" }]}>\n        <Feather name=\"shield\" size={64} color={theme.primary} />\n      </View>\n      <ThemedText style={styles.title}>Safe Connect</ThemedText>\n      <ThemedText style={[styles.subtitle, { color: theme.textSecondary }]}>\n        Your personal safety companion. Track journeys, send emergency alerts, and stay connected with those who matter most.\n      </ThemedText>\n    </View>\n  );\n\n  const renderPhoneStep = () => (\n    <View style={styles.stepContainer}>\n      <View style={[styles.iconCircle, { backgroundColor: theme.primary + \"20\" }]}>\n        <Feather name=\"smartphone\" size={64} color={theme.primary} />\n      </View>\n      <ThemedText style={styles.title}>Enter Your Phone</ThemedText>\n      <ThemedText style={[styles.subtitle, { color: theme.textSecondary }]}>\n        We'll send you a verification code to confirm your phone number.\n      </ThemedText>\n\n      <View style={styles.avatarContainer}>\n        {AVATARS.map((avatar, index) => (\n          <Pressable\n            key={index}\n            onPress={() => {\n              setSelectedAvatar(index);\n              Haptics.selectionAsync();\n            }}\n            style={[\n              styles.avatarButton,\n              { backgroundColor: avatar.color + \"20\" },\n              selectedAvatar === index && { borderColor: avatar.color, borderWidth: 3 },\n            ]}\n          >\n            <Feather name={avatar.icon as any} size={28} color={avatar.color} />\n          </Pressable>\n        ))}\n      </View>\n\n      <TextInput\n        style={[\n          styles.input,\n          {\n            backgroundColor: theme.backgroundSecondary,\n            color: theme.text,\n            borderColor: theme.border,\n          },\n        ]}\n        placeholder=\"Enter phone number (e.g., +1234567890)\"\n        placeholderTextColor={theme.textSecondary}\n        value={phone}\n        onChangeText={setPhone}\n        keyboardType=\"phone-pad\"\n        autoFocus\n      />\n\n      <Pressable\n        style={[\n          styles.sendOtpButton,\n          { backgroundColor: theme.primary },\n          isLoading && { opacity: 0.6 },\n        ]}\n        onPress={handleSendOTP}\n        disabled={isLoading}\n      >\n        <Feather name=\"send\" size={20} color=\"#FFF\" />\n        <ThemedText style={styles.sendOtpButtonText}>\n          {isLoading ? \"Sending...\" : \"Send OTP\"}\n        </ThemedText>\n      </Pressable>\n    </View>\n  );\n\n  const renderOtpStep = () => (\n    <View style={styles.stepContainer}>\n      <View style={[styles.iconCircle, { backgroundColor: theme.success + \"20\" }]}>\n        <Feather name=\"check-circle\" size={64} color={theme.success} />\n      </View>\n      <ThemedText style={styles.title}>Enter Verification Code</ThemedText>\n      <ThemedText style={[styles.subtitle, { color: theme.textSecondary }]}>\n        We've sent a 6-digit code to {phone}. Enter it below to verify.\n      </ThemedText>\n\n      <TextInput\n        style={[\n          styles.otpInput,\n          {\n            backgroundColor: theme.backgroundSecondary,\n            color: theme.text,\n            borderColor: theme.border,\n          },\n        ]}\n        placeholder=\"000000\"\n        placeholderTextColor={theme.textSecondary}\n        value={otpCode}\n        onChangeText={(text) => setOtpCode(text.replace(/[^0-9]/g, \"\").slice(0, 6))}\n        keyboardType=\"number-pad\"\n        maxLength={6}\n        autoFocus\n      />\n\n      <Pressable\n        style={[\n          styles.verifyButton,\n          { backgroundColor: theme.primary },\n          isLoading && { opacity: 0.6 },\n        ]}\n        onPress={handleVerifyOTP}\n        disabled={isLoading}\n      >\n        <Feather name=\"check\" size={20} color=\"#FFF\" />\n        <ThemedText style={styles.verifyButtonText}>\n          {isLoading ? \"Verifying...\" : \"Verify Code\"}\n        </ThemedText>\n      </Pressable>\n\n      <Pressable\n        style={[styles.resendButton, countdown > 0 && { opacity: 0.5 }]}\n        onPress={handleResendOTP}\n        disabled={countdown > 0 || isLoading}\n      >\n        <ThemedText style={[styles.resendText, { color: theme.primary }]}>\n          {countdown > 0 ? `Resend code in ${countdown}s` : \"Resend Code\"}\n        </ThemedText>\n      </Pressable>\n\n      <Pressable\n        style={styles.changePhoneButton}\n        onPress={() => {\n          setStep(\"phone\");\n          setOtpCode(\"\");\n        }}\n      >\n        <ThemedText style={[styles.changePhoneText, { color: theme.textSecondary }]}>\n          Change phone number\n        </ThemedText>\n      </Pressable>\n    </View>\n  );\n\n  const renderPermissions = () => (\n    <View style={styles.stepContainer}>\n      <View style={[styles.iconCircle, { backgroundColor: theme.primary + \"20\" }]}>\n        <Feather name=\"map-pin\" size={64} color={theme.primary} />\n      </View>\n      <ThemedText style={styles.title}>Enable Location</ThemedText>\n      <ThemedText style={[styles.subtitle, { color: theme.textSecondary }]}>\n        We need location access to track your journeys and share your location during emergencies.\n      </ThemedText>\n\n      <Pressable\n        style={[styles.permissionButton, { backgroundColor: theme.primary }]}\n        onPress={handleRequestLocation}\n      >\n        <Feather name=\"navigation\" size={20} color=\"#FFF\" />\n        <ThemedText style={styles.permissionButtonText}>Enable Location Access</ThemedText>\n      </Pressable>\n    </View>\n  );\n\n  const renderContact = () => (\n    <View style={styles.stepContainer}>\n      <View style={[styles.iconCircle, { backgroundColor: theme.danger + \"20\" }]}>\n        <Feather name=\"phone\" size={64} color={theme.danger} />\n      </View>\n      <ThemedText style={styles.title}>Add Emergency Contact</ThemedText>\n      <ThemedText style={[styles.subtitle, { color: theme.textSecondary }]}>\n        Add someone who will be notified if you trigger an SOS or don't arrive at your destination.\n      </ThemedText>\n\n      <TextInput\n        style={[\n          styles.input,\n          {\n            backgroundColor: theme.backgroundSecondary,\n            color: theme.text,\n            borderColor: theme.border,\n          },\n        ]}\n        placeholder=\"Contact name\"\n        placeholderTextColor={theme.textSecondary}\n        value={contactName}\n        onChangeText={setContactName}\n        autoCapitalize=\"words\"\n      />\n\n      <TextInput\n        style={[\n          styles.input,\n          {\n            backgroundColor: theme.backgroundSecondary,\n            color: theme.text,\n            borderColor: theme.border,\n          },\n        ]}\n        placeholder=\"Phone number\"\n        placeholderTextColor={theme.textSecondary}\n        value={contactPhone}\n        onChangeText={setContactPhone}\n        keyboardType=\"phone-pad\"\n      />\n\n      <TextInput\n        style={[\n          styles.input,\n          {\n            backgroundColor: theme.backgroundSecondary,\n            color: theme.text,\n            borderColor: theme.border,\n          },\n        ]}\n        placeholder=\"Relationship (e.g., Mom, Partner)\"\n        placeholderTextColor={theme.textSecondary}\n        value={contactRelationship}\n        onChangeText={setContactRelationship}\n        autoCapitalize=\"words\"\n      />\n    </View>\n  );\n\n  const showContinueButton = step === \"welcome\" || step === \"permissions\" || step === \"contact\";\n\n  return (\n    <ThemedView style={styles.container}>\n      <KeyboardAwareScrollViewCompat\n        contentContainerStyle={[\n          styles.scrollContent,\n          { paddingTop: insets.top + Spacing.xl, paddingBottom: insets.bottom + Spacing[\"3xl\"] },\n        ]}\n      >\n        {step === \"welcome\" && renderWelcome()}\n        {step === \"phone\" && renderPhoneStep()}\n        {step === \"otp\" && renderOtpStep()}\n        {step === \"permissions\" && renderPermissions()}\n        {step === \"contact\" && renderContact()}\n\n        {showContinueButton && (\n          <View style={styles.buttonContainer}>\n            <Pressable\n              style={[\n                styles.nextButton,\n                { backgroundColor: theme.primary },\n                isLoading && { opacity: 0.6 },\n              ]}\n              onPress={handleNext}\n              disabled={isLoading}\n            >\n              <ThemedText style={styles.nextButtonText}>\n                {isLoading\n                  ? \"Loading...\"\n                  : step === \"contact\"\n                  ? contactName && contactPhone\n                    ? \"Finish Setup\"\n                    : \"Skip & Finish\"\n                  : \"Continue\"}\n              </ThemedText>\n              <Feather name=\"arrow-right\" size={20} color=\"#FFF\" />\n            </Pressable>\n\n            {step === \"contact\" && contactName && contactPhone && (\n              <Pressable style={styles.skipButton} onPress={handleSkip}>\n                <ThemedText style={[styles.skipText, { color: theme.textSecondary }]}>\n                  Skip for now\n                </ThemedText>\n              </Pressable>\n            )}\n          </View>\n        )}\n\n        <View style={styles.progressContainer}>\n          {[\"welcome\", \"phone\", \"otp\", \"permissions\", \"contact\"].map((s, i) => (\n            <View\n              key={s}\n              style={[\n                styles.progressDot,\n                {\n                  backgroundColor:\n                    s === step\n                      ? theme.primary\n                      : [\"welcome\", \"phone\", \"otp\", \"permissions\", \"contact\"].indexOf(step) > i\n                      ? theme.primary + \"80\"\n                      : theme.border,\n                },\n              ]}\n            />\n          ))}\n        </View>\n      </KeyboardAwareScrollViewCompat>\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  scrollContent: {\n    flexGrow: 1,\n    paddingHorizontal: Spacing.xl,\n  },\n  stepContainer: {\n    flex: 1,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  iconCircle: {\n    width: 120,\n    height: 120,\n    borderRadius: 60,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    marginBottom: Spacing[\"2xl\"],\n  },\n  title: {\n    ...Typography.h2,\n    textAlign: \"center\",\n    marginBottom: Spacing.md,\n  },\n  subtitle: {\n    ...Typography.body,\n    textAlign: \"center\",\n    marginBottom: Spacing[\"2xl\"],\n    paddingHorizontal: Spacing.lg,\n  },\n  avatarContainer: {\n    flexDirection: \"row\",\n    flexWrap: \"wrap\",\n    justifyContent: \"center\",\n    gap: Spacing.md,\n    marginBottom: Spacing[\"2xl\"],\n  },\n  avatarButton: {\n    width: 56,\n    height: 56,\n    borderRadius: 28,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    borderWidth: 2,\n    borderColor: \"transparent\",\n  },\n  input: {\n    width: \"100%\",\n    height: Spacing.inputHeight,\n    borderRadius: BorderRadius.sm,\n    paddingHorizontal: Spacing.lg,\n    borderWidth: 1,\n    marginBottom: Spacing.md,\n    ...Typography.body,\n  },\n  otpInput: {\n    width: \"60%\",\n    height: Spacing.inputHeight * 1.2,\n    borderRadius: BorderRadius.sm,\n    paddingHorizontal: Spacing.lg,\n    borderWidth: 1,\n    marginBottom: Spacing.xl,\n    ...Typography.h2,\n    textAlign: \"center\",\n    letterSpacing: 10,\n  },\n  sendOtpButton: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    width: \"100%\",\n    height: Spacing.buttonHeight,\n    borderRadius: BorderRadius.md,\n    gap: Spacing.sm,\n    marginTop: Spacing.md,\n  },\n  sendOtpButtonText: {\n    color: \"#FFF\",\n    ...Typography.body,\n    fontWeight: \"600\",\n  },\n  verifyButton: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    width: \"100%\",\n    height: Spacing.buttonHeight,\n    borderRadius: BorderRadius.md,\n    gap: Spacing.sm,\n  },\n  verifyButtonText: {\n    color: \"#FFF\",\n    ...Typography.body,\n    fontWeight: \"600\",\n  },\n  resendButton: {\n    paddingVertical: Spacing.lg,\n  },\n  resendText: {\n    ...Typography.body,\n    fontWeight: \"500\",\n  },\n  changePhoneButton: {\n    paddingVertical: Spacing.sm,\n  },\n  changePhoneText: {\n    ...Typography.body,\n  },\n  permissionButton: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    paddingVertical: Spacing.lg,\n    paddingHorizontal: Spacing[\"2xl\"],\n    borderRadius: BorderRadius.md,\n    gap: Spacing.sm,\n  },\n  permissionButtonText: {\n    color: \"#FFF\",\n    ...Typography.body,\n    fontWeight: \"600\",\n  },\n  buttonContainer: {\n    paddingTop: Spacing[\"2xl\"],\n  },\n  nextButton: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    height: Spacing.buttonHeight,\n    borderRadius: BorderRadius.md,\n    gap: Spacing.sm,\n  },\n  nextButtonText: {\n    color: \"#FFF\",\n    ...Typography.body,\n    fontWeight: \"600\",\n  },\n  skipButton: {\n    alignItems: \"center\",\n    paddingVertical: Spacing.lg,\n  },\n  skipText: {\n    ...Typography.body,\n  },\n  progressContainer: {\n    flexDirection: \"row\",\n    justifyContent: \"center\",\n    gap: Spacing.sm,\n    paddingTop: Spacing[\"2xl\"],\n  },\n  progressDot: {\n    width: 8,\n    height: 8,\n    borderRadius: 4,\n  },\n});\n","path":null,"size_bytes":19336,"size_tokens":null},"client/components/ErrorFallback.tsx":{"content":"import React, { useState } from \"react\";\nimport { reloadAppAsync } from \"expo\";\nimport {\n  StyleSheet,\n  View,\n  Pressable,\n  ScrollView,\n  Text,\n  Modal,\n} from \"react-native\";\nimport { Feather } from \"@expo/vector-icons\";\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Spacing, BorderRadius, Fonts } from \"@/constants/theme\";\n\nexport type ErrorFallbackProps = {\n  error: Error;\n  resetError: () => void;\n};\n\nexport function ErrorFallback({ error, resetError }: ErrorFallbackProps) {\n  const { theme } = useTheme();\n  const [isModalVisible, setIsModalVisible] = useState(false);\n\n  const handleRestart = async () => {\n    try {\n      await reloadAppAsync();\n    } catch (restartError) {\n      console.error(\"Failed to restart app:\", restartError);\n      resetError();\n    }\n  };\n\n  const formatErrorDetails = (): string => {\n    let details = `Error: ${error.message}\\n\\n`;\n    if (error.stack) {\n      details += `Stack Trace:\\n${error.stack}`;\n    }\n    return details;\n  };\n\n  return (\n    <ThemedView style={styles.container}>\n      {__DEV__ ? (\n        <Pressable\n          onPress={() => setIsModalVisible(true)}\n          style={({ pressed }) => [\n            styles.topButton,\n            {\n              backgroundColor: theme.backgroundDefault,\n              opacity: pressed ? 0.8 : 1,\n            },\n          ]}\n        >\n          <Feather name=\"alert-circle\" size={20} color={theme.text} />\n        </Pressable>\n      ) : null}\n\n      <View style={styles.content}>\n        <ThemedText type=\"h1\" style={styles.title}>\n          Something went wrong\n        </ThemedText>\n\n        <ThemedText type=\"body\" style={styles.message}>\n          Please reload the app to continue.\n        </ThemedText>\n\n        <Pressable\n          onPress={handleRestart}\n          style={({ pressed }) => [\n            styles.button,\n            {\n              backgroundColor: theme.link,\n              opacity: pressed ? 0.9 : 1,\n              transform: [{ scale: pressed ? 0.98 : 1 }],\n            },\n          ]}\n        >\n          <ThemedText\n            type=\"body\"\n            style={[styles.buttonText, { color: theme.buttonText }]}\n          >\n            Try Again\n          </ThemedText>\n        </Pressable>\n      </View>\n\n      {__DEV__ ? (\n        <Modal\n          visible={isModalVisible}\n          animationType=\"slide\"\n          transparent={true}\n          onRequestClose={() => setIsModalVisible(false)}\n        >\n          <View style={styles.modalOverlay}>\n            <ThemedView style={styles.modalContainer}>\n              <View style={styles.modalHeader}>\n                <ThemedText type=\"h2\" style={styles.modalTitle}>\n                  Error Details\n                </ThemedText>\n                <Pressable\n                  onPress={() => setIsModalVisible(false)}\n                  style={({ pressed }) => [\n                    styles.closeButton,\n                    { opacity: pressed ? 0.6 : 1 },\n                  ]}\n                >\n                  <Feather name=\"x\" size={24} color={theme.text} />\n                </Pressable>\n              </View>\n\n              <ScrollView\n                style={styles.modalScrollView}\n                contentContainerStyle={styles.modalScrollContent}\n                showsVerticalScrollIndicator\n              >\n                <View\n                  style={[\n                    styles.errorContainer,\n                    { backgroundColor: theme.backgroundDefault },\n                  ]}\n                >\n                  <Text\n                    style={[\n                      styles.errorText,\n                      {\n                        color: theme.text,\n                        fontFamily: Fonts?.mono || \"monospace\",\n                      },\n                    ]}\n                    selectable\n                  >\n                    {formatErrorDetails()}\n                  </Text>\n                </View>\n              </ScrollView>\n            </ThemedView>\n          </View>\n        </Modal>\n      ) : null}\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    width: \"100%\",\n    height: \"100%\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    padding: Spacing[\"2xl\"],\n  },\n  content: {\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    gap: Spacing.lg,\n    width: \"100%\",\n    maxWidth: 600,\n  },\n  title: {\n    textAlign: \"center\",\n    lineHeight: 40,\n  },\n  message: {\n    textAlign: \"center\",\n    opacity: 0.7,\n    lineHeight: 24,\n  },\n  topButton: {\n    position: \"absolute\",\n    top: Spacing[\"2xl\"] + Spacing.lg,\n    right: Spacing.lg,\n    width: 44,\n    height: 44,\n    borderRadius: BorderRadius.md,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    zIndex: 10,\n  },\n  button: {\n    paddingVertical: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    paddingHorizontal: Spacing[\"2xl\"],\n    minWidth: 200,\n    shadowColor: \"#000\",\n    shadowOffset: {\n      width: 0,\n      height: 2,\n    },\n    shadowOpacity: 0.1,\n    shadowRadius: 4,\n    elevation: 3,\n  },\n  buttonText: {\n    fontWeight: \"600\",\n    textAlign: \"center\",\n    fontSize: 16,\n  },\n  modalOverlay: {\n    flex: 1,\n    backgroundColor: \"rgba(0, 0, 0, 0.5)\",\n    justifyContent: \"flex-end\",\n  },\n  modalContainer: {\n    width: \"100%\",\n    height: \"90%\",\n    borderTopLeftRadius: BorderRadius.lg,\n    borderTopRightRadius: BorderRadius.lg,\n  },\n  modalHeader: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    paddingHorizontal: Spacing.lg,\n    paddingTop: Spacing.lg,\n    paddingBottom: Spacing.md,\n    borderBottomWidth: 1,\n    borderBottomColor: \"rgba(128, 128, 128, 0.2)\",\n  },\n  modalTitle: {\n    fontWeight: \"600\",\n  },\n  closeButton: {\n    padding: Spacing.xs,\n  },\n  modalScrollView: {\n    flex: 1,\n  },\n  modalScrollContent: {\n    padding: Spacing.lg,\n  },\n  errorContainer: {\n    width: \"100%\",\n    borderRadius: BorderRadius.md,\n    overflow: \"hidden\",\n    padding: Spacing.lg,\n  },\n  errorText: {\n    fontSize: 12,\n    lineHeight: 18,\n    width: \"100%\",\n  },\n});\n","path":null,"size_bytes":6194,"size_tokens":null},"client/navigation/MainTabNavigator.tsx":{"content":"import React from \"react\";\nimport { createBottomTabNavigator } from \"@react-navigation/bottom-tabs\";\nimport { Feather } from \"@expo/vector-icons\";\nimport { BlurView } from \"expo-blur\";\nimport { Platform, StyleSheet } from \"react-native\";\nimport HomeScreen from \"@/screens/HomeScreen\";\nimport JourneyHistoryScreen from \"@/screens/JourneyHistoryScreen\";\nimport ProfileScreen from \"@/screens/ProfileScreen\";\nimport { useTheme } from \"@/hooks/useTheme\";\n\nexport type MainTabParamList = {\n  HomeTab: undefined;\n  HistoryTab: undefined;\n  ProfileTab: undefined;\n};\n\nconst Tab = createBottomTabNavigator<MainTabParamList>();\n\nexport default function MainTabNavigator() {\n  const { theme, isDark } = useTheme();\n\n  return (\n    <Tab.Navigator\n      initialRouteName=\"HomeTab\"\n      screenOptions={{\n        tabBarActiveTintColor: theme.tabIconSelected,\n        tabBarInactiveTintColor: theme.tabIconDefault,\n        tabBarStyle: {\n          position: \"absolute\",\n          backgroundColor: Platform.select({\n            ios: \"transparent\",\n            android: theme.backgroundRoot,\n          }),\n          borderTopWidth: 0,\n          elevation: 0,\n        },\n        tabBarBackground: () =>\n          Platform.OS === \"ios\" ? (\n            <BlurView\n              intensity={100}\n              tint={isDark ? \"dark\" : \"light\"}\n              style={StyleSheet.absoluteFill}\n            />\n          ) : null,\n        headerShown: false,\n      }}\n    >\n      <Tab.Screen\n        name=\"HomeTab\"\n        component={HomeScreen}\n        options={{\n          title: \"Home\",\n          tabBarIcon: ({ color, size }) => (\n            <Feather name=\"shield\" size={size} color={color} />\n          ),\n        }}\n      />\n      <Tab.Screen\n        name=\"HistoryTab\"\n        component={JourneyHistoryScreen}\n        options={{\n          title: \"History\",\n          tabBarIcon: ({ color, size }) => (\n            <Feather name=\"clock\" size={size} color={color} />\n          ),\n        }}\n      />\n      <Tab.Screen\n        name=\"ProfileTab\"\n        component={ProfileScreen}\n        options={{\n          title: \"Profile\",\n          tabBarIcon: ({ color, size }) => (\n            <Feather name=\"user\" size={size} color={color} />\n          ),\n        }}\n      />\n    </Tab.Navigator>\n  );\n}\n","path":null,"size_bytes":2268,"size_tokens":null},"client/screens/ProfileScreen.tsx":{"content":"import React from \"react\";\nimport { View, StyleSheet, Pressable, ScrollView, Alert } from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport type { NativeStackNavigationProp } from \"@react-navigation/native-stack\";\nimport { useBottomTabBarHeight } from \"@react-navigation/bottom-tabs\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as Haptics from \"expo-haptics\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { Card } from \"@/components/Card\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useUserStore } from \"@/stores/userStore\";\nimport { Spacing, BorderRadius, Typography } from \"@/constants/theme\";\nimport type { RootStackParamList } from \"@/navigation/RootStackNavigator\";\n\nconst AVATARS = [\n  { icon: \"user\", color: \"#007AFF\" },\n  { icon: \"smile\", color: \"#34C759\" },\n  { icon: \"heart\", color: \"#FF2D55\" },\n  { icon: \"star\", color: \"#FF9500\" },\n  { icon: \"sun\", color: \"#FFCC00\" },\n  { icon: \"moon\", color: \"#5856D6\" },\n];\n\nexport default function ProfileScreen() {\n  const insets = useSafeAreaInsets();\n  const tabBarHeight = useBottomTabBarHeight();\n  const navigation = useNavigation<NativeStackNavigationProp<RootStackParamList>>();\n  const { theme } = useTheme();\n  const { user, emergencyContacts, reset } = useUserStore();\n\n  const avatarInfo = AVATARS[user?.avatarIndex || 0];\n\n  const handleLogout = () => {\n    Alert.alert(\n      \"Reset App\",\n      \"This will reset all your data and return to onboarding. Are you sure?\",\n      [\n        { text: \"Cancel\", style: \"cancel\" },\n        {\n          text: \"Reset\",\n          style: \"destructive\",\n          onPress: () => {\n            reset();\n          },\n        },\n      ]\n    );\n  };\n\n  const menuItems = [\n    {\n      icon: \"user\",\n      title: \"Edit Profile\",\n      subtitle: \"Update your personal information\",\n      onPress: () => navigation.navigate(\"EditProfile\"),\n    },\n    {\n      icon: \"users\",\n      title: \"Emergency Contacts\",\n      subtitle: `${emergencyContacts.length} contact${emergencyContacts.length !== 1 ? \"s\" : \"\"} saved`,\n      onPress: () => navigation.navigate(\"EmergencyContacts\"),\n    },\n  ];\n\n  return (\n    <ThemedView style={styles.container}>\n      <ScrollView\n        contentContainerStyle={[\n          styles.scrollContent,\n          { paddingTop: insets.top + Spacing[\"3xl\"], paddingBottom: tabBarHeight + Spacing.xl },\n        ]}\n        showsVerticalScrollIndicator={false}\n        scrollIndicatorInsets={{ bottom: insets.bottom }}\n      >\n        <View style={styles.header}>\n          <View style={[styles.avatarCircle, { backgroundColor: avatarInfo.color + \"20\" }]}>\n            <Feather name={avatarInfo.icon as any} size={40} color={avatarInfo.color} />\n          </View>\n          <ThemedText style={styles.userName}>{user?.name || \"User\"}</ThemedText>\n          <ThemedText style={[styles.userSubtitle, { color: theme.textSecondary }]}>\n            Safe Connect Member\n          </ThemedText>\n        </View>\n\n        <Card style={styles.menuCard}>\n          {menuItems.map((item, index) => (\n            <Pressable\n              key={item.title}\n              style={[\n                styles.menuItem,\n                index < menuItems.length - 1 && { borderBottomWidth: 1, borderBottomColor: theme.border },\n              ]}\n              onPress={() => {\n                Haptics.selectionAsync();\n                item.onPress();\n              }}\n            >\n              <View style={[styles.menuIconContainer, { backgroundColor: theme.primary + \"20\" }]}>\n                <Feather name={item.icon as any} size={20} color={theme.primary} />\n              </View>\n              <View style={styles.menuTextContainer}>\n                <ThemedText style={styles.menuTitle}>{item.title}</ThemedText>\n                <ThemedText style={[styles.menuSubtitle, { color: theme.textSecondary }]}>\n                  {item.subtitle}\n                </ThemedText>\n              </View>\n              <Feather name=\"chevron-right\" size={20} color={theme.textSecondary} />\n            </Pressable>\n          ))}\n        </Card>\n\n        {user?.codeWord ? (\n          <Card style={styles.codeWordCard}>\n            <View style={styles.codeWordHeader}>\n              <View style={[styles.codeWordIcon, { backgroundColor: theme.warning + \"20\" }]}>\n                <Feather name=\"key\" size={20} color={theme.warning} />\n              </View>\n              <ThemedText style={styles.codeWordTitle}>Secret Code Word</ThemedText>\n            </View>\n            <ThemedText style={[styles.codeWordText, { color: theme.textSecondary }]}>\n              Your code word: <ThemedText style={styles.codeWordValue}>{user.codeWord}</ThemedText>\n            </ThemedText>\n            <ThemedText style={[styles.codeWordHint, { color: theme.textSecondary }]}>\n              Share this with your contacts. They can ask for it to verify it's really you.\n            </ThemedText>\n          </Card>\n        ) : null}\n\n        <Card style={styles.statsCard}>\n          <ThemedText style={styles.statsTitle}>App Status</ThemedText>\n          <View style={styles.statsRow}>\n            <View style={styles.statItem}>\n              <ThemedText style={[styles.statValue, { color: theme.primary }]}>\n                {emergencyContacts.length}\n              </ThemedText>\n              <ThemedText style={[styles.statLabel, { color: theme.textSecondary }]}>\n                Contacts\n              </ThemedText>\n            </View>\n            <View style={[styles.statDivider, { backgroundColor: theme.border }]} />\n            <View style={styles.statItem}>\n              <Feather\n                name=\"check-circle\"\n                size={24}\n                color={theme.success}\n              />\n              <ThemedText style={[styles.statLabel, { color: theme.textSecondary }]}>\n                Protected\n              </ThemedText>\n            </View>\n          </View>\n        </Card>\n\n        <Pressable\n          style={[styles.logoutButton, { borderColor: theme.danger }]}\n          onPress={handleLogout}\n        >\n          <Feather name=\"log-out\" size={20} color={theme.danger} />\n          <ThemedText style={[styles.logoutText, { color: theme.danger }]}>Reset App</ThemedText>\n        </Pressable>\n      </ScrollView>\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  scrollContent: {\n    paddingHorizontal: Spacing.lg,\n  },\n  header: {\n    alignItems: \"center\",\n    marginBottom: Spacing[\"2xl\"],\n  },\n  avatarCircle: {\n    width: 80,\n    height: 80,\n    borderRadius: 40,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    marginBottom: Spacing.md,\n  },\n  userName: {\n    ...Typography.h3,\n    marginBottom: Spacing.xs,\n  },\n  userSubtitle: {\n    ...Typography.body,\n  },\n  menuCard: {\n    marginBottom: Spacing.lg,\n    padding: 0,\n    overflow: \"hidden\",\n  },\n  menuItem: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    padding: Spacing.lg,\n  },\n  menuIconContainer: {\n    width: 40,\n    height: 40,\n    borderRadius: 20,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  menuTextContainer: {\n    flex: 1,\n    marginLeft: Spacing.md,\n  },\n  menuTitle: {\n    ...Typography.body,\n    fontWeight: \"600\",\n  },\n  menuSubtitle: {\n    ...Typography.small,\n  },\n  codeWordCard: {\n    marginBottom: Spacing.lg,\n    padding: Spacing.lg,\n  },\n  codeWordHeader: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    marginBottom: Spacing.md,\n  },\n  codeWordIcon: {\n    width: 36,\n    height: 36,\n    borderRadius: 18,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    marginRight: Spacing.sm,\n  },\n  codeWordTitle: {\n    ...Typography.body,\n    fontWeight: \"600\",\n  },\n  codeWordText: {\n    ...Typography.body,\n    marginBottom: Spacing.sm,\n  },\n  codeWordValue: {\n    fontWeight: \"700\",\n  },\n  codeWordHint: {\n    ...Typography.small,\n    fontStyle: \"italic\",\n  },\n  statsCard: {\n    marginBottom: Spacing.lg,\n    padding: Spacing.lg,\n  },\n  statsTitle: {\n    ...Typography.body,\n    fontWeight: \"600\",\n    marginBottom: Spacing.md,\n  },\n  statsRow: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  statItem: {\n    flex: 1,\n    alignItems: \"center\",\n  },\n  statValue: {\n    ...Typography.h3,\n  },\n  statLabel: {\n    ...Typography.small,\n    marginTop: Spacing.xs,\n  },\n  statDivider: {\n    width: 1,\n    height: 40,\n  },\n  logoutButton: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    height: Spacing.buttonHeight,\n    borderRadius: BorderRadius.md,\n    borderWidth: 2,\n    gap: Spacing.sm,\n  },\n  logoutText: {\n    ...Typography.body,\n    fontWeight: \"600\",\n  },\n});\n","path":null,"size_bytes":8777,"size_tokens":null},"client/components/Button.tsx":{"content":"import React, { ReactNode } from \"react\";\nimport { StyleSheet, Pressable, ViewStyle, StyleProp } from \"react-native\";\nimport Animated, {\n  useAnimatedStyle,\n  useSharedValue,\n  withSpring,\n  WithSpringConfig,\n} from \"react-native-reanimated\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { BorderRadius, Spacing } from \"@/constants/theme\";\n\ninterface ButtonProps {\n  onPress?: () => void;\n  children: ReactNode;\n  style?: StyleProp<ViewStyle>;\n  disabled?: boolean;\n}\n\nconst springConfig: WithSpringConfig = {\n  damping: 15,\n  mass: 0.3,\n  stiffness: 150,\n  overshootClamping: true,\n  energyThreshold: 0.001,\n};\n\nconst AnimatedPressable = Animated.createAnimatedComponent(Pressable);\n\nexport function Button({\n  onPress,\n  children,\n  style,\n  disabled = false,\n}: ButtonProps) {\n  const { theme } = useTheme();\n  const scale = useSharedValue(1);\n\n  const animatedStyle = useAnimatedStyle(() => ({\n    transform: [{ scale: scale.value }],\n  }));\n\n  const handlePressIn = () => {\n    if (!disabled) {\n      scale.value = withSpring(0.98, springConfig);\n    }\n  };\n\n  const handlePressOut = () => {\n    if (!disabled) {\n      scale.value = withSpring(1, springConfig);\n    }\n  };\n\n  return (\n    <AnimatedPressable\n      onPress={disabled ? undefined : onPress}\n      onPressIn={handlePressIn}\n      onPressOut={handlePressOut}\n      disabled={disabled}\n      style={[\n        styles.button,\n        {\n          backgroundColor: theme.link,\n          opacity: disabled ? 0.5 : 1,\n        },\n        style,\n        animatedStyle,\n      ]}\n    >\n      <ThemedText\n        type=\"body\"\n        style={[styles.buttonText, { color: theme.buttonText }]}\n      >\n        {children}\n      </ThemedText>\n    </AnimatedPressable>\n  );\n}\n\nconst styles = StyleSheet.create({\n  button: {\n    height: Spacing.buttonHeight,\n    borderRadius: BorderRadius.full,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  buttonText: {\n    fontWeight: \"600\",\n  },\n});\n","path":null,"size_bytes":2014,"size_tokens":null},"eslint.config.js":{"content":"// https://docs.expo.dev/guides/using-eslint/\nconst { defineConfig } = require(\"eslint/config\");\nconst expoConfig = require(\"eslint-config-expo/flat\");\nconst eslintPluginPrettierRecommended = require(\"eslint-plugin-prettier/recommended\");\n\nmodule.exports = defineConfig([\n  expoConfig,\n  eslintPluginPrettierRecommended,\n  {\n    ignores: [\"dist/*\"],\n  },\n]);\n","path":null,"size_bytes":359,"size_tokens":null},"client/screens/JourneySetupScreen.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport {\n  View,\n  TextInput,\n  StyleSheet,\n  Pressable,\n  Alert,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useHeaderHeight } from \"@react-navigation/elements\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport type { NativeStackNavigationProp } from \"@react-navigation/native-stack\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as Location from \"expo-location\";\nimport * as Haptics from \"expo-haptics\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { KeyboardAwareScrollViewCompat } from \"@/components/KeyboardAwareScrollViewCompat\";\nimport { Card } from \"@/components/Card\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useUserStore } from \"@/stores/userStore\";\nimport { Spacing, BorderRadius, Typography } from \"@/constants/theme\";\nimport type { RootStackParamList } from \"@/navigation/RootStackNavigator\";\n\nconst DURATION_OPTIONS = [15, 30, 45, 60, 90, 120];\n\nexport default function JourneySetupScreen() {\n  const insets = useSafeAreaInsets();\n  const headerHeight = useHeaderHeight();\n  const navigation = useNavigation<NativeStackNavigationProp<RootStackParamList>>();\n  const { theme } = useTheme();\n  const { createJourney, hasLocationPermission } = useUserStore();\n\n  const [destination, setDestination] = useState(\"\");\n  const [selectedDuration, setSelectedDuration] = useState(30);\n  const [note, setNote] = useState(\"\");\n  const [startLocation, setStartLocation] = useState(\"Current Location\");\n  const [coordinates, setCoordinates] = useState<{ lat: string; lng: string } | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n\n  useEffect(() => {\n    const getCurrentLocation = async () => {\n      if (hasLocationPermission) {\n        try {\n          const location = await Location.getCurrentPositionAsync({\n            accuracy: Location.Accuracy.Balanced,\n          });\n          setCoordinates({\n            lat: location.coords.latitude.toString(),\n            lng: location.coords.longitude.toString(),\n          });\n          \n          try {\n            const [address] = await Location.reverseGeocodeAsync({\n              latitude: location.coords.latitude,\n              longitude: location.coords.longitude,\n            });\n            if (address) {\n              const parts = [address.street, address.city].filter(Boolean);\n              if (parts.length > 0) {\n                setStartLocation(parts.join(\", \"));\n              }\n            }\n          } catch {}\n        } catch (e) {\n          console.error(\"Error getting location:\", e);\n        }\n      }\n    };\n    getCurrentLocation();\n  }, [hasLocationPermission]);\n\n  const handleStartJourney = async () => {\n    if (!destination.trim()) {\n      Alert.alert(\"Destination Required\", \"Please enter where you're going.\");\n      return;\n    }\n\n    await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n    setIsLoading(true);\n\n    try {\n      const journey = await createJourney({\n        startLocation,\n        startLatitude: coordinates?.lat,\n        startLongitude: coordinates?.lng,\n        destination: destination.trim(),\n        estimatedDuration: selectedDuration,\n        bufferTime: 10,\n        note: note.trim() || undefined,\n      });\n\n      if (journey) {\n        navigation.replace(\"ActiveJourney\");\n      } else {\n        Alert.alert(\"Error\", \"Failed to start journey. Please try again.\");\n      }\n    } catch (error) {\n      Alert.alert(\"Error\", \"Something went wrong. Please try again.\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const formatDuration = (minutes: number) => {\n    if (minutes < 60) return `${minutes} min`;\n    const hours = Math.floor(minutes / 60);\n    const mins = minutes % 60;\n    return mins > 0 ? `${hours}h ${mins}m` : `${hours}h`;\n  };\n\n  return (\n    <ThemedView style={styles.container}>\n      <KeyboardAwareScrollViewCompat\n        style={{ flex: 1 }}\n        contentContainerStyle={[\n          styles.scrollContent,\n          { paddingTop: headerHeight + Spacing.xl, paddingBottom: insets.bottom + Spacing[\"2xl\"] },\n        ]}\n        scrollIndicatorInsets={{ bottom: insets.bottom }}\n      >\n        <Card style={styles.locationCard}>\n          <View style={styles.locationRow}>\n            <View style={[styles.locationDot, { backgroundColor: theme.success }]} />\n            <View style={styles.locationInfo}>\n              <ThemedText style={[styles.locationLabel, { color: theme.textSecondary }]}>\n                Starting from\n              </ThemedText>\n              <ThemedText style={styles.locationValue}>{startLocation}</ThemedText>\n            </View>\n          </View>\n\n          <View style={[styles.locationDivider, { backgroundColor: theme.border }]} />\n\n          <View style={styles.locationRow}>\n            <View style={[styles.locationDot, { backgroundColor: theme.primary }]} />\n            <View style={styles.locationInfo}>\n              <ThemedText style={[styles.locationLabel, { color: theme.textSecondary }]}>\n                Going to\n              </ThemedText>\n              <TextInput\n                style={[styles.destinationInput, { color: theme.text }]}\n                placeholder=\"Enter destination\"\n                placeholderTextColor={theme.textSecondary}\n                value={destination}\n                onChangeText={setDestination}\n                autoFocus\n              />\n            </View>\n          </View>\n        </Card>\n\n        <ThemedText style={styles.sectionTitle}>Estimated Duration</ThemedText>\n        <View style={styles.durationGrid}>\n          {DURATION_OPTIONS.map((duration) => (\n            <Pressable\n              key={duration}\n              style={[\n                styles.durationButton,\n                { backgroundColor: theme.backgroundSecondary },\n                selectedDuration === duration && { backgroundColor: theme.primary },\n              ]}\n              onPress={() => {\n                setSelectedDuration(duration);\n                Haptics.selectionAsync();\n              }}\n            >\n              <ThemedText\n                style={[\n                  styles.durationText,\n                  selectedDuration === duration && { color: \"#FFF\" },\n                ]}\n              >\n                {formatDuration(duration)}\n              </ThemedText>\n            </Pressable>\n          ))}\n        </View>\n\n        <ThemedText style={styles.sectionTitle}>Add a Note (Optional)</ThemedText>\n        <TextInput\n          style={[\n            styles.noteInput,\n            {\n              backgroundColor: theme.backgroundSecondary,\n              color: theme.text,\n              borderColor: theme.border,\n            },\n          ]}\n          placeholder=\"e.g., Meeting with Sarah at the coffee shop\"\n          placeholderTextColor={theme.textSecondary}\n          value={note}\n          onChangeText={setNote}\n          multiline\n          numberOfLines={3}\n        />\n\n        <View style={styles.infoBox}>\n          <Feather name=\"info\" size={16} color={theme.primary} />\n          <ThemedText style={[styles.infoText, { color: theme.textSecondary }]}>\n            Your contacts will be notified if you don't check in within 10 minutes of your expected arrival.\n          </ThemedText>\n        </View>\n\n        <Pressable\n          style={[\n            styles.startButton,\n            { backgroundColor: theme.primary },\n            isLoading && { opacity: 0.6 },\n          ]}\n          onPress={handleStartJourney}\n          disabled={isLoading}\n        >\n          <Feather name=\"navigation\" size={20} color=\"#FFF\" />\n          <ThemedText style={styles.startButtonText}>\n            {isLoading ? \"Starting...\" : \"Start Journey\"}\n          </ThemedText>\n        </Pressable>\n      </KeyboardAwareScrollViewCompat>\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  scrollContent: {\n    paddingHorizontal: Spacing.lg,\n  },\n  locationCard: {\n    padding: Spacing.lg,\n    marginBottom: Spacing[\"2xl\"],\n  },\n  locationRow: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  locationDot: {\n    width: 12,\n    height: 12,\n    borderRadius: 6,\n  },\n  locationInfo: {\n    flex: 1,\n    marginLeft: Spacing.md,\n  },\n  locationLabel: {\n    ...Typography.small,\n    marginBottom: Spacing.xs,\n  },\n  locationValue: {\n    ...Typography.body,\n    fontWeight: \"500\",\n  },\n  destinationInput: {\n    ...Typography.body,\n    fontWeight: \"500\",\n    padding: 0,\n    margin: 0,\n  },\n  locationDivider: {\n    width: 2,\n    height: 24,\n    marginLeft: 5,\n    marginVertical: Spacing.sm,\n  },\n  sectionTitle: {\n    ...Typography.body,\n    fontWeight: \"600\",\n    marginBottom: Spacing.md,\n  },\n  durationGrid: {\n    flexDirection: \"row\",\n    flexWrap: \"wrap\",\n    gap: Spacing.sm,\n    marginBottom: Spacing[\"2xl\"],\n  },\n  durationButton: {\n    paddingVertical: Spacing.md,\n    paddingHorizontal: Spacing.lg,\n    borderRadius: BorderRadius.sm,\n    minWidth: 80,\n    alignItems: \"center\",\n  },\n  durationText: {\n    ...Typography.body,\n    fontWeight: \"500\",\n  },\n  noteInput: {\n    borderRadius: BorderRadius.sm,\n    borderWidth: 1,\n    padding: Spacing.md,\n    minHeight: 80,\n    textAlignVertical: \"top\",\n    ...Typography.body,\n    marginBottom: Spacing.xl,\n  },\n  infoBox: {\n    flexDirection: \"row\",\n    alignItems: \"flex-start\",\n    gap: Spacing.sm,\n    marginBottom: Spacing[\"2xl\"],\n    paddingHorizontal: Spacing.sm,\n  },\n  infoText: {\n    ...Typography.small,\n    flex: 1,\n    lineHeight: 20,\n  },\n  startButton: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    height: Spacing.buttonHeight,\n    borderRadius: BorderRadius.md,\n    gap: Spacing.sm,\n  },\n  startButtonText: {\n    color: \"#FFF\",\n    ...Typography.body,\n    fontWeight: \"600\",\n  },\n});\n","path":null,"size_bytes":9905,"size_tokens":null},"client/hooks/useScreenOptions.ts":{"content":"import { Platform } from \"react-native\";\nimport { NativeStackNavigationOptions } from \"@react-navigation/native-stack\";\nimport { isLiquidGlassAvailable } from \"expo-glass-effect\";\n\nimport { useTheme } from \"@/hooks/useTheme\";\n\ninterface UseScreenOptionsParams {\n  transparent?: boolean;\n}\n\nexport function useScreenOptions({\n  transparent = true,\n}: UseScreenOptionsParams = {}): NativeStackNavigationOptions {\n  const { theme, isDark } = useTheme();\n\n  return {\n    headerTitleAlign: \"center\",\n    headerTransparent: transparent,\n    headerBlurEffect: isDark ? \"dark\" : \"light\",\n    headerTintColor: theme.text,\n    headerStyle: {\n      backgroundColor: Platform.select({\n        ios: undefined,\n        android: theme.backgroundRoot,\n        web: theme.backgroundRoot,\n      }),\n    },\n    gestureEnabled: true,\n    gestureDirection: \"horizontal\",\n    fullScreenGestureEnabled: isLiquidGlassAvailable() ? false : true,\n    contentStyle: {\n      backgroundColor: theme.backgroundRoot,\n    },\n  };\n}\n","path":null,"size_bytes":1000,"size_tokens":null}},"version":2}